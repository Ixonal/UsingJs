/*

UsingJs script loader and dependency tracker
Copyright 2013-2016 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(r){function M(a,b){z[a]||(z[a]=[]);z[a].push(b)}function E(a,b){var c=z[a];if(c)for(var k=0,e=c.length;k<e;k++)c[k].call(null,w({},b))}function w(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,k,e,d;k=1;for(d=arguments.length;k<d;k++)if(c=arguments[k])for(e in c)b[e]=c[e];return b}function A(a){var b=arguments[0],c,k,e,d,f;if(!b||b.constructor!==N)throw Error("The mergee must be an array.");k=1;for(d=arguments.length;k<d;k++){c=
arguments[k];if(!c||c.constructor!==N)throw Error("The merger must be an array.");e=0;for(f=c.length;e<f;e++)b.push(c[e])}}function x(a,b){for(var c=0,k=a.length;c<k;c++)if(a[c]===b)return c;return-1}function F(a,b){for(var c=0,k=a.length;c<k;c++)if(a[c].matches(b))return c;return-1}function g(a,b){return null===a?"null":a===r?"undefined":"object"===typeof a?"[object Array]"===Object.prototype.toString.call(a)?b?"array":0<a.length?"array<"+g(a[0])+">":"array<object>":a.constructor===h.RegExp?"regexp":
a.constructor===h.Date?"date":a.src?"dependency":"object":typeof a}function O(a){f=w({},W,f,a);if(!f.browser){var b=w,c=f,k;k={name:"unknown",version:null};var e,d=3,n,y;if(h.navigator)if(e=X.exec(h.navigator.userAgent)){n=u.createElement("div");for(y=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++d+"]><i></i><![endif]--\x3e",y[0];);k.name="ie";k.version=4<d?d:+(e[2]||e[4])}else if(e=Y.exec(h.navigator.userAgent))k.name="cr",k.version=+e[1];else if(e=Z.exec(h.navigator.userAgent))k.name=
"ff",k.version=+e[1];else if(e=aa.exec(h.navigator.userAgent))k.name="sf",k.version=+e[1];k={browser:k};b(c,k)}f.environment="undefined"!==typeof h.module&&this.module!==h.module?"nd":h.document?"wb":"ww";a:{d=u.getElementsByTagName("script");y=["using.js","using.min.js",f.srcName];var g,b=0;for(k=d.length;b<k;b++)for(n=d[b].src.replace(/([#?][\s\w\\]+)+$/,""),c=0,e=y.length;c<e;c++)if((g=y[c])&&n.substr(n.length-g.length,g.length)===g){b=d[b];break a}b=null}var l,t,q,p;b&&(l=b.getAttribute("data-script-root")||
a&&a.scriptRoot||f.scriptRoot,t=b.getAttribute("data-style-root")||a&&a.styleRoot||f.styleRoot,q=b.getAttribute("data-using"),p=b.getAttribute("data-using-css"),f.scriptTag=b);(l=l||f.scriptRoot)&&"/"!==l.substr(l.length-1,1)&&(l+="/");f.scriptRoot=l||"/";t&&"/"!==t.substr(t.length-1,1)&&(t+="/");f.styleRoot=t||"/";q&&(f.initialUsing=h.eval("("+q+")"));p&&(f.initialStyleUsing=h.eval("("+p+")"))}function P(a){f.debug&&h.console&&h.console.warn(a)}function B(a){switch(g(a)){case "string":return ba.test(a)?
"js":ca.test(a)?"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?"js":a.type||B(a.src)}}function Q(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}function C(a){var b;switch(g(a,!0)){case "string":a=Q(a);break;case "dependency":a.noExtension||(a.src=Q(a.src));a.type="css";break;case "array":for(b=a.length;b--;)a[b]=C(a[b])}return a}function R(){return"ie"===f.browser.name&&10>=f.browser.version}function da(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===
Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function S(a,b,c){b=b.split(/[\.\/\\]+/);var d,e;d=0;for(e=b.length-1;d<e;d++)a=a[b[d]]=a[b[d]]||{};a[b[b.length-1]]=c}function q(a,b,c,d,e,m,n){this.src=a;this.type=b||B(a);this.h=d;this.m=c;this.i=[];this.C=[];this.g=[];this.b=[];this.j={};this.M=n;e&&(this.name=e);this.B=m!==r?m:f.minified}function G(){if(!H){H=!0;for(var a=I.length;a--;)I[a]()}}function ea(){if(!J){J=!0;var a=f.pollingTimeout;setTimeout(function c(){H||
(l.O()?G():setTimeout(c,a));J=!1},a)}}function K(a,b,c,k){var e,m,n,h,p,r,t=l.empty();switch(g(a,!0)){case "function":d.ready(a);return;case "string":case "dependency":case "array":e=T.s(a);break;default:throw Error("Valid dependencies must be entered");}n=[];k?p=k:t||v?p=l.I():R()?(p=l.ja())||(p=l.I()):"currentScript"in u&&((p=l.ia())||(p=l.I()));for(m=e.length;m--;){h=l.l(e[m]);if(!h){switch(g(e[m],!0)){case "string":r=!1;h=new q(e[m],B(e[m]),!1,null);break;case "dependency":r=e[m].dependsOn,h=
new q(e[m].src,B(e[m]),e[m].noExtension,e[m].backup,e[m].name,e[m].minified,e[m].exports)}l.P(h);r?function(){var a=h;K(e[m].dependsOn,function(){a.load()},null,a);a.A()}():h.A()}n.push(h)}if(p){for(m=n.length;m--;)p.L(n[m]),k&&n[m].v(b,n);b&&!k&&p.v(b,n);c&&(p.name=c)}else{a=new q("<||usingContext||>"+fa++,"<||usingContext||>",a.noExtension,a.backup,c,a.minified);l.P(a);for(m=n.length;m--;)a.L(n[m]);b&&a.v(b,n);c&&(a.name=c);a.A();t||v||R()||U.push(a)}"ie"===f.browser.name&&ea()}function d(a,b){K(a,
b);return d}var h=this||(0,eval)("this"),f=h.using?h.using.config:null,N=h.Array,W={scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},U=[],v=!1,u=h.document||{getElementsByTagName:function(){return[]}},X=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,Y=/Chrome\/(\d+)/i,Z=/Firefox\/(\d+)/i,aa=/Safari\/(\d+)/i,ba=/\.((js)|(jscript))$/i,ca=/\.(css)$/i,V=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,p={},D={},L={};p[8]=!0;p[5]=!0;p[6]=!0;p[9]=!0;D[4]=!0;D[7]=!0;D[8]=!0;L[7]=!0;L[8]=!0;var z={};
O(f);var T={map:{},l:function(a){var b,c,d=g(a,!0);for(b in this.map)for(c=this.map[b].length;c--;)switch(d){case "string":switch(g(this.map[b][c],!0)){case "string":if(this.map[b][c]===a)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a)return this.map[b][c]}break;case "dependency":switch(g(this.map[b][c],!0)){case "string":if(this.map[b][c]===a.src)return this.map[b][c];break;case "dependency":var e=this.map[b][c];if(e.src===a.src&&e.type===a.type&&e.conditionally===a.conditionally&&
e.dependsOn===a.dependsOn&&e.noExtension===a.noExtension&&e.backup===a.backup)return this.map[b][c]}}return null},$:function(a,b){if("string"!==g(a))throw Error("The alias must be a string.");var c;c=g(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===c&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");switch(c){case "array":d=[];for(c=b.length;c--;)A(d,this.s(b[c]));break;case "string":case "dependency":d=this.s(b);
break;default:throw Error("Unknown dependency type found");}this.map[a]=d;return this},s:function(a){var b=[],c,d;switch(g(a,!0)){case "string":if(this.map[a])for(c=0,d=this.map[a].length;c<d;c++)A(b,this.s(this.map[a][c]));else return[a];break;case "dependency":return a.conditionally===r||!0===a.conditionally?(b=this.s(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===a.length)return b;for(c=a.length;c--;)A(b,this.s(a[c]));0===b.length&&A(b,a);break;default:throw Error("Alias is not a recognized type.");
}return 0===b.length?[a]:b}};w(q.prototype,{src:null,h:null,u:!1,type:"js",m:!1,status:0,g:null,b:null,i:null,C:null,a:null,j:null,name:null,B:!1,M:null,S:function(){if(6!==this.status){var a;for(a=this.g.length;a--;)this.g[a].matches(this)&&this.g.splice(a,1);for(a=this.b.length;a--;)this.b[a].matches(this)&&this.b.splice(a,1);delete this.g;delete this.b;delete this.i;delete this.a;delete this.a;delete this.src;delete this.h;delete this.u;delete this.type;this.status=6}},da:function(){var a;if(4===
this.status){this.status=7;for(a=this.b.length;a--;)8!==this.b[a].status&&this.b[a].o();this.N();this.status=8;E("dependency-status-terminal");for(a=this.g.length;a--;){var b=this.g[a];8!=b.status?b.o():b.N()}"<||page||>"!==this.type&&l.O()&&G()}},Z:function(a){switch(g(a,!0)){case "object":w(this.j,a);break;default:a&&(this.j=a)}},ea:function(a){var b,c,d={};a=a||this.b;for(b=a.length;b--;)if(c=a[b],da(c.j)){if(c.M){var e;a:{e=c.M.split(/[\.\/\\]+/);var f=h,n,g;n=0;for(g=e.length;n<g;n++)if(f=f[e[n]],
f===r){e=null;break a}e=f}S(d,c.name||c.src,e)}}else S(d,c.name||c.src,c.j);return d},o:function(){if(4===this.status||9===this.status)9===this.status?l.O()&&G():this.W()&&this.da()},R:function(a){var b,c=this.b.length;a=a||[];for(a.push(this);c--;)if(b=this.b[c],-1!==x(a,b)){if(f.debug){var d="Cyclic dependency found (non-terminal): \n",e;for(e=0;e<a.length;e++)d+=a[e]===b?"---\x3e":"    ",d+=(a[e].name||a[e].src)+"\n";d+="---\x3e"+(b.name||b.src);P(d)}}else if(!b.V())return!1;return!0},W:function(a){return this.status in
D&&this.R(a)},V:function(a){return this.status in L&&this.R(a)},L:function(a){if(!a||a.constructor!==q)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===F(this.b,a)&&(a.g.push(this),this.b.push(a)),4===a.status&&this.o())},N:function(a,b){a=(a||this.i).slice(0);b=(b||this.C).slice(0);if(this.W())for(var c,d,e;(c=a.pop())&&(d=b.pop());){try{e=c.call(null,this.ea(d),this.j)}catch(f){this.error()}this.Z(e);c=x(this.i,c);-1<c&&(this.i.splice(c,1),this.C.splice(c,
1))}else for(d=a.length;d--;)this.v(a[d])},v:function(a,b){if("function"!==g(a))throw Error("dependency resolution callback function must be a function.");this.V()?this.N([a],[b]):-1===x(this.i,a)&&(this.i.push(a),this.C.push(b))},matches:function(a){var b=g(a);return"string"===b?this.src===a:"dependency"===b?this.src===a.src&&this.type==a.type:!1},ka:function(a){if(!this.matches(a)){var b=F(this.b,a);0<=b&&this.b.splice(b,1);b=F(a.g,this);0<=b&&a.g.splice(b,1)}},resolve:function(){if(3===this.status){for(var a,
b,c;(b=U.shift())!==r;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=b.name);b.m&&(this.m=b.m);b.B!==r&&(this.B=b.B);b.h&&(this.h=b.h);b.j&&this.Z(b.j);for(a=b.b.length;a--;)c=b.b[a],this.L(c),b.ka(c);for(a=b.i.length;a--;)this.v(b.i[a],b.C[a]);l.X(b);b.S()}this.status=4;this.o()}},error:function(a){var b,c;this.status=9;E("dependency-status-terminal");E("dependency-failed",{ca:this});b=this.u?this.h:this.src;"page"===b&&(b="page");"<||usingContext||>"===b&&(b="using context");
c="UsingJs: An error has occurred when loading "+b;a&&(b=a.u?a.h:a.src,"page"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");f.debug&&h.console&&h.console.error(c);for(a=this.g.length;a--;)b=this.g[a],b.status in p||b.error(this);this.o()},Y:function(){var a=""+(this.u?this.h:this.src),b=(new Date).getTime(),c;(c=a)?(V.lastIndex=0,c=(c=V.exec(c))?h.location?c[1]!==h.location.protocol||c[2]!==h.location.host:!0:!1):c=!1;if(c)return a+(f.cached?
"":(-1===a.indexOf("?")?"?_t=":"&_t=")+b);!this.m&&this.B&&-1===a.indexOf("min")&&(a+=".min");this.m||"<||usingContext||>"===this.type||"<||page||>"===this.type||a.substr(a.length-this.type.length)===this.type||(a+="."+this.type);"/"===a.substr(0,1)&&(a=a.substr(1));f.cached&&f.version&&(a+=(0<=a.indexOf("?")?"&":"?")+"_v="+encodeURIComponent(f.version));f.cached||(a+=(0<=a.indexOf("?")?"&":"?")+"_t="+b);switch(this.type){case "js":return f.scriptRoot+a;case "css":return f.styleRoot+a;default:return"/"+
a}},load:function(){var a=this,b,c;if(1===a.status){for(b=a.b.length;b--;){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("wb"==f.environment){if("js"===a.type)a.a=u.createElement("script"),a.a.setAttribute("src",a.Y()),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===a.type)a.a=u.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",a.Y()),a.a.setAttribute("rel",
"stylesheet");else throw Error("Attempting to load an unsupported file type: "+a.type);b=function(){a.h&&!a.u?(P("Error occurred while loading "+a.src+", attempting to load "+a.h),a.u=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.resolve()},!0),a.a.addEventListener("error",b,!0)):"ie"===f.browser.name&&9>f.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=
null,a.status=3,a.resolve()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");f.scriptTag?f.scriptTag.parentElement.appendChild(a.a):u.getElementsByTagName("body")[0].appendChild(a.a)}else throw Error("This functionality is not yet implemented");}},A:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==this.type?(this.status=1,this.load()):(this.status=4,this.o()))}});var l={c:{},D:0,ga:function(a){function b(a){var d=
1,f,h=a.b.length,g;for(f=0;f<h;f++)g=a.b[f],-1===x(c,g)&&(d+=b(g)),c.push(g);return d}if(!a)return this.D;a=this.l(a);var c=[];return b(a)},fa:function(a){function b(a){var d=a.status in p?1:0,f,h=a.b.length,g;for(f=0;f<h;f++)g=a.b[f],-1===x(c,g)&&(d+=b(g)),c.push(g);return d}a=a?this.l(a):this.I();var c=[];return b(a)},G:null,w:[],ha:function(a){this.w.push(a);this.G&&this.T()},T:function(){for(var a=0,b=this.w.length;a<b;a++)this.w[a].call(null,this.G.name||this.G.src);this.w.splice(0,this.w.length)},
empty:function(){return 0===this.D},I:function(){if(this.c["<||page||>"])return this.c["<||page||>"];var a=new q("page","<||page||>");this.c["<||page||>"]=a;a.A();return a},ja:function(){var a=u.getElementsByTagName("script"),b;for(b=0;b<a.length;b++)if("interactive"===a[b].readyState)return this.U(a[b]);return null},ia:function(){return this.U(u.currentScript)},U:function(a){if(!a)return null;for(var b in this.c){var c=this.c[b];if(c.a&&c.a===a)return c}return null},l:function(a){switch(g(a)){case "string":return this.c[a]||
null;case "dependency":return this.c[a.src]?this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},P:function(a){if(!this.l(a)){var b;switch(g(a)){case "string":b=new q(a,"js");b.A();this.c[a]=b;break;case "dependency":this.c[a.src]=a}}this.D++;return this},X:function(a){switch(g(a)){case "string":return this.X(this.l(a));case "dependency":delete this.c[a.src],a.S()}this.D--;return this},la:function(a){"array"!==g(a,!0)&&(a=[a]);for(var b=a.length;b--;)switch(g(a[b],!0)){case "string":if(!this.c[a])return!1;
break;case "object":if(!this.c[a.src])return!1}return!0},O:function(){var a,b;for(a=this.c.length;a--;)if(b=this.c[a].status,b in p)return!1;return!0}},I=[],H=!1,J=!1;M("dependency-failed",function(a){l.G=a.ca;l.T()});var fa=0;d.aa=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);K(b,c,a);return d};d.amd=d.aa;d.H=function(a){if("function"!==typeof a)throw Error("callback must be a function");l.ha(a)};d.failure=d.H;d.J=function(a){if("function"!==typeof a)throw Error("callback must be a function");
M("dependency-status-terminal",function(){a.call(null,l.ga(),l.fa())})};d.progress=d.J;d.page=function(a,b){v=!0;switch(g(a,!0)){case "function":a.call(h);break;default:d(a,b)}v=!1;return d};d.page=d.page;d.page.f=function(a,b){v=!0;switch(g(a,!0)){case "function":a.call(h);break;default:d.f(a,b)}v=!1;return d};d.page.css=d.page.f;d.page.J=function(a){return d.J(a)};d.page.progress=d.page.J;d.page.H=function(a){return d.H(a)};d.page.failure=d.page.H;d.ready=function(a){I.push(a);return d};d.ready=
d.ready;d.ba=function(a){O(a);return d};d.config=d.ba;d.K=function(a,b,c){a&&d(b,c);return d};d.conditionally=d.K;d.F=function(a,b){T.$(a,b);return d};d.alias=d.F;d.f=function(a,b){var c;switch(g(a,!0)){case "string":case "dependency":return d(C(a),b);case "array":for(c=a.length;c--;)a[c]=C(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");}};d.css=d.f;d.f.K=function(a,b,c){a&&d.f(b,c);return d};d.f.conditionally=d.f.K;d.f.F=function(a,b){return d.F(a,C(b))};d.f.alias=
d.f.F;h.using=d;f.initialUsing&&d.page(f.initialUsing);f.initialStyleUsing&&d.page.f(f.initialStyleUsing);return d})();