/*

UsingJs script loader and dependency tracker
Copyright 2013-2016 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(v){function M(a,b){z[a]||(z[a]=[]);z[a].push(b)}function E(a,b){var c=z[a];if(c)for(var e=0,f=c.length;e<f;e++)c[e].call(null,x({},b))}function x(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,e,f,d;e=1;for(d=arguments.length;e<d;e++)if(c=arguments[e])for(f in c)b[f]=c[f];return b}function A(a){var b=arguments[0],c,e,f,d,g;if(!b||b.constructor!==N)throw Error("The mergee must be an array.");e=1;for(d=arguments.length;e<d;e++){c=
arguments[e];if(!c||c.constructor!==N)throw Error("The merger must be an array.");f=0;for(g=c.length;f<g;f++)b.push(c[f])}}function y(a,b){for(var c=0,e=a.length;c<e;c++)if(a[c]===b)return c;return-1}function F(a,b){for(var c=0,e=a.length;c<e;c++)if(a[c].matches(b))return c;return-1}function k(a,b){return null===a?"null":a===v?"undefined":"object"===typeof a?"[object Array]"===Object.prototype.toString.call(a)?b?"array":0<a.length?"array<"+k(a[0])+">":"array<object>":a.constructor===h.RegExp?"regexp":
a.constructor===h.Date?"date":a.src?"dependency":"object":typeof a}function O(a){g=x({},W,g,a);if(!g.browser){var b=x,c=g,e;e={name:"unknown",version:null};var f,d=3,n,q;if(h.navigator){if(f=X.exec(h.navigator.userAgent)){n=u.createElement("div");for(q=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++d+"]><i></i><![endif]--\x3e",q[0];);e.name="ie";e.version=4<d?d:+(f[2]||f[4])}else if(f=Y.exec(h.navigator.userAgent))e.name="cr",e.version=+f[1];else if(f=Z.exec(h.navigator.userAgent))e.name=
"ff",e.version=+f[1];else if(f=aa.exec(h.navigator.userAgent))e.name="sf",e.version=+f[1];e={browser:e}}else e={browser:e};b(c,e)}g.environment="undefined"!==typeof h.module&&this.module!==h.module?"nd":h.document?"wb":"ww";a:{d=u.getElementsByTagName("script");q=["using.js","using.min.js",g.srcName];var k,b=0;for(e=d.length;b<e;b++)for(n=d[b].src,c=0,f=q.length;c<f;c++)if((k=q[c])&&n.substr(n.length-k.length,k.length)===k){b=d[b];break a}b=null}var l,t,r,p;b&&(l=b.getAttribute("data-script-root")||
a&&a.scriptRoot||g.scriptRoot,t=b.getAttribute("data-style-root")||a&&a.styleRoot||g.styleRoot,r=b.getAttribute("data-using"),p=b.getAttribute("data-using-css"));(l=l||g.scriptRoot)&&"/"!==l.substr(l.length-1,1)&&(l+="/");g.scriptRoot=l||"/";t&&"/"!==t.substr(t.length-1,1)&&(t+="/");g.styleRoot=t||"/";r&&(g.initialUsing=h.eval("("+r+")"));p&&(g.initialStyleUsing=h.eval("("+p+")"))}function P(a){g.debug&&h.console&&h.console.warn(a)}function B(a){switch(k(a)){case "string":return ba.test(a)?"js":ca.test(a)?
"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?"js":a.type||B(a.src)}}function Q(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}function C(a){var b;switch(k(a,!0)){case "string":a=Q(a);break;case "dependency":a.noExtension||(a.src=Q(a.src));a.type="css";break;case "array":for(b=a.length;b--;)a[b]=C(a[b])}return a}function R(){return"ie"===g.browser.name&&10>=g.browser.version}function da(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===
Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function S(a,b,c){b=b.split(/[\.\/\\]+/);var e,f;e=0;for(f=b.length-1;e<f;e++)a=a[b[e]]=a[b[e]]||{};a[b[b.length-1]]=c}function r(a,b,c,e,f,d,n){this.src=a;this.type=b||B(a);this.j=e;this.s=c;this.i=[];this.L=[];this.g=[];this.b=[];this.m={};this.J=n;f&&(this.name=f);this.C=d!==v?d:g.minified}function G(){if(!H){H=!0;for(var a=I.length;a--;)I[a]()}}function ea(){if(!J){J=!0;var a=g.pollingTimeout;setTimeout(function c(){H||
(l.N()?G():setTimeout(c,a));J=!1},a)}}function K(a,b,c,e){var f,m,n,q,h,p,t=l.empty();switch(k(a,!0)){case "function":d.S(a);return;case "string":case "dependency":case "array":f=T.v(a);break;default:throw Error("Valid dependencies must be entered");}n=[];e?h=e:t||w?h=l.H():R()?(h=l.ha())||(h=l.H()):"currentScript"in u&&((h=l.ga())||(h=l.H()));for(m=f.length;m--;){q=l.o(f[m]);if(!q){switch(k(f[m],!0)){case "string":p=!1;q=new r(f[m],B(f[m]),!1,null);break;case "dependency":p=f[m].dependsOn,q=new r(f[m].src,
B(f[m]),f[m].noExtension,f[m].backup,f[m].name,f[m].minified,f[m].exports)}l.O(q);p?function(){var a=q;K(f[m].dependsOn,function(){a.load()},null,a);a.G()}():q.G()}n.push(q)}if(h){for(m=n.length;m--;)h.I(n[m]),e&&n[m].A(b,n);b&&!e&&h.A(b,n);c&&(h.name=c)}else{a=new r("<||usingContext||>"+fa++,"<||usingContext||>",a.noExtension,a.backup,c,a.minified);l.O(a);for(m=n.length;m--;)a.I(n[m]);b&&a.A(b,n);c&&(a.name=c);t||w||R()||U.push(a)}"ie"===g.browser.name&&ea()}function d(a,b){K(a,b);return d}var h=
this||(0,eval)("this"),g=h.using?h.using.config:null,N=h.Array,W={scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},U=[],w=!1,u=h.document||{getElementsByTagName:function(){return[]}},X=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,Y=/Chrome\/(\d+)/i,Z=/Firefox\/(\d+)/i,aa=/Safari\/(\d+)/i,ba=/\.((js)|(jscript))$/i,ca=/\.(css)$/i,V=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,p={},D={},L={};p[8]=!0;p[5]=!0;p[6]=!0;p[9]=!0;D[4]=!0;D[7]=!0;D[8]=!0;L[7]=!0;L[8]=!0;var z={};O(g);var T={map:{},
o:function(a){var b,c,e=k(a,!0);for(b in this.map)for(c=this.map[b].length;c--;)switch(e){case "string":switch(k(this.map[b][c],!0)){case "string":if(this.map[b][c]===a)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a)return this.map[b][c]}break;case "dependency":switch(k(this.map[b][c],!0)){case "string":if(this.map[b][c]===a.src)return this.map[b][c];break;case "dependency":var f=this.map[b][c];if(f.src===a.src&&f.type===a.type&&f.conditionally===a.conditionally&&f.dependsOn===
a.dependsOn&&f.noExtension===a.noExtension&&f.backup===a.backup)return this.map[b][c]}}return null},X:function(a,b){if("string"!==k(a))throw Error("The alias must be a string.");var c;c=k(b,!0);var e;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===c&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");switch(c){case "array":e=[];for(c=b.length;c--;)A(e,this.v(b[c]));break;case "string":case "dependency":e=this.v(b);break;
default:throw Error("Unknown dependency type found");}this.map[a]=e;return this},v:function(a){var b=[],c,e;switch(k(a,!0)){case "string":if(this.map[a])for(c=0,e=this.map[a].length;c<e;c++)A(b,this.v(this.map[a][c]));else return[a];break;case "dependency":return a.conditionally===v||!0===a.conditionally?(b=this.v(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===a.length)return b;for(c=a.length;c--;)A(b,this.v(a[c]));0===b.length&&A(b,a);break;default:throw Error("Alias is not a recognized type.");
}return 0===b.length?[a]:b}};x(r.prototype,{src:null,j:null,w:!1,type:"js",s:!1,status:0,g:null,b:null,i:null,L:null,a:null,m:null,name:null,C:!1,J:null,Z:function(){if(6!==this.status){var a;for(a=this.g.length;a--;)this.g[a].matches(this)&&this.g.splice(a,1);for(a=this.b.length;a--;)this.b[a].matches(this)&&this.b.splice(a,1);delete this.g;delete this.b;delete this.i;delete this.a;delete this.a;delete this.src;delete this.j;delete this.w;delete this.type;this.status=6}},$:function(){var a;if(4===
this.status){this.status=7;for(a=this.b.length;a--;)8!==this.b[a].status&&this.b[a].u();this.M();this.status=8;E("dependency-status-terminal");for(a=this.g.length;a--;){var b=this.g[a];8!=b.status?b.u():b.M()}"<||page||>"!==this.type&&l.N()&&G()}},ja:function(a){switch(k(a,!0)){case "object":x(this.m,a);break;default:a&&(this.m=a)}},aa:function(a){var b,c,e={};a=a||this.b;for(b=a.length;b--;)if(c=a[b],da(c.m)){if(c.J){var f;a:{f=c.J.split(/[\.\/\\]+/);for(var d=h,g=void 0,k=void 0,g=0,k=f.length;g<
k;g++)if(d=d[f[g]],d===v){f=null;break a}f=d}S(e,c.name||c.src,f)}}else S(e,c.name||c.src,c.m);return e},u:function(){if(4===this.status||9===this.status)9===this.status?l.N()&&G():this.U()&&this.$()},P:function(a){var b,c=this.b.length;a=a||[];for(a.push(this);c--;)if(b=this.b[c],-1!==y(a,b)){if(g.debug){var e="Cyclic dependency found (non-terminal): \n",d;for(d=0;d<a.length;d++)e+=a[d]===b?"---\x3e":"    ",e+=(a[d].name||a[d].src)+"\n";e+="---\x3e"+(b.name||b.src);P(e)}}else if(!b.T())return!1;
return!0},U:function(a){return this.status in D&&this.P(a)},T:function(a){return this.status in L&&this.P(a)},I:function(a){if(!a||a.constructor!==r)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===F(this.b,a)&&(a.g.push(this),this.b.push(a)),4===a.status&&this.u())},M:function(a,b){a=(a||this.i).slice(0);b=(b||this.L).slice(0);if(this.U())for(var c,d,f;(c=a.pop())&&(d=b.pop());)f=c.call(null,this.aa(d),this.m),this.ja(f),c=y(this.i,c),-1<c&&this.i.splice(c,
1);else for(d=a.length;d--;)this.A(a[d])},A:function(a,b){if("function"!==k(a))throw Error("dependency resolution callback function must be a function.");this.T()?this.M([a],[b]):-1===y(this.i,a)&&(this.i.push(a),this.L.push(b))},matches:function(a){var b=k(a);return"string"===b?this.src===a:"dependency"===b?this.src===a.src&&this.type==a.type:!1},ia:function(a){if(!this.matches(a)){var b=F(this.b,a);0<=b&&this.b.splice(b,1);b=F(a.g,this);0<=b&&a.g.splice(b,1)}},resolve:function(){if(3===this.status){for(var a,
b,c;(b=U.shift())!==v;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=b.name);b.s&&(this.s=b.s);b.C!==v&&(this.C=b.C);for(a=b.b.length;a--;)c=b.b[a],this.I(c),b.ia(c);for(a=b.i.length;a--;)this.A(b.i[a]);l.V(b)}this.status=4;this.u()}},error:function(a){var b,c;this.status=9;E("dependency-status-terminal");E("dependency-failed",{Y:this});b=this.w?this.j:this.src;"page"===b&&(b="page");"<||usingContext||>"===b&&(b="using context");c="UsingJs: An error has occurred when loading "+
b;a&&(b=a.w?a.j:a.src,"page"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");g.debug&&h.console&&h.console.error(c);for(a=this.g.length;a--;)b=this.g[a],b.status in p||b.error(this);this.u()},W:function(){var a=""+(this.w?this.j:this.src),b=(new Date).getTime(),c;(c=a)?(V.lastIndex=0,c=(c=V.exec(c))?h.location?c[1]!==h.location.protocol||c[2]!==h.location.host:!0:!1):c=!1;if(c)return a+(g.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+b);
!this.s&&this.C&&-1===a.indexOf("min")&&(a+=".min");this.s||"<||usingContext||>"===this.type||"<||page||>"===this.type||a.substr(a.length-this.type.length)===this.type||(a+="."+this.type);"/"===a.substr(0,1)&&(a=a.substr(1));g.cached&&g.version&&(a+=(0<=a.indexOf("?")?"&":"?")+"_v="+encodeURIComponent(g.version));g.cached||(a+=(0<=a.indexOf("?")?"&":"?")+"_t="+b);switch(this.type){case "js":return g.scriptRoot+a;case "css":return g.styleRoot+a;default:return"/"+a}},load:function(){var a=this,b,c;
if(1===a.status){for(b=a.b.length;b--;){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("wb"==g.environment){if("js"===a.type)a.a=u.createElement("script"),a.a.setAttribute("src",a.W()),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===a.type)a.a=u.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",a.W()),a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+
a.type);b=function(){a.j&&!a.w?(P("Error occurred while loading "+a.src+", attempting to load "+a.j),a.w=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.resolve()},!0),a.a.addEventListener("error",b,!0)):"ie"===g.browser.name&&9>g.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.resolve()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");
u.getElementsByTagName("head")[0].appendChild(a.a)}else throw Error("This functionality is not yet implemented");}},G:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==this.type?(this.status=1,this.load()):(this.status=4,this.u()))}});var l={c:{},D:0,ca:function(a){function b(a){var d=1,g,h=a.b.length,k;for(g=0;g<h;g++)k=a.b[g],-1===y(c,k)&&(d+=b(k)),c.push(k);return d}if(!a)return this.D;a=this.o(a);var c=[];return b(a)},ba:function(a){function b(a){var d=a.status in p?
1:0,g,h=a.b.length,k;for(g=0;g<h;g++)k=a.b[g],-1===y(c,k)&&(d+=b(k)),c.push(k);return d}a=a?this.o(a):this.H();var c=[];return b(a)},F:null,B:[],ea:function(a){this.B.push(a);this.F&&this.R()},R:function(){for(var a=0,b=this.B.length;a<b;a++)this.B[a].call(null,this.F.name||this.F.src);this.B.splice(0,this.B.length)},empty:function(){return 0===this.D},H:function(){if(this.c["<||page||>"])return this.c["<||page||>"];var a=new r("page","<||page||>");this.c["<||page||>"]=a;a.G();return a},ha:function(){var a,
b;for(a in this.c)if(b=this.c[a],b.a&&"interactive"===b.a.readyState)return b;return null},ga:function(){var a,b,c=u.currentScript;if(!c||!c.src)return null;for(a in this.c)if(b=this.c[a],b.a&&b.a===c)return b;return null},o:function(a){switch(k(a)){case "string":return this.c[a]||null;case "dependency":return this.c[a.src]?this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},O:function(a){if(!this.o(a)){var b;switch(k(a)){case "string":b=new r(a,"js");b.G();this.c[a]=
b;break;case "dependency":this.c[a.src]=a}}this.D++;return this},V:function(a){switch(k(a)){case "string":return this.V(this.o(a));case "dependency":delete this.c[a.src],a.Z()}this.D--;return this},ka:function(a){"array"!==k(a,!0)&&(a=[a]);for(var b=a.length;b--;)switch(k(a[b],!0)){case "string":if(!this.c[a])return!1;break;case "object":if(!this.c[a.src])return!1}return!0},N:function(){var a,b;for(a=this.c.length;a--;)if(b=this.c[a].status,b in p)return!1;return!0}},I=[],H=!1,J=!1;M("dependency-failed",
function(a){l.F=a.Y;l.R()});var fa=0;d.da=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);K(b,c,a);return d};d.amd=d.da;d.f=function(a,b){w=!0;switch(k(a,!0)){case "function":a.call(h);break;default:d(a,b)}w=!1;return d};d.page=d.f;d.f.f=function(a,b){w=!0;switch(k(a,!0)){case "function":a.call(h);break;default:d.h(a,b)}w=!1;return d};d.f.css=d.f.f;d.f.l=function(a){if("function"!==typeof a)throw Error("callback must be a function");M("dependency-status-terminal",function(){a.call(null,l.ca(),
l.ba())})};d.f.progress=d.f.l;d.f.h=function(a){if("function"!==typeof a)throw Error("callback must be a function");l.ea(a)};d.f.failure=d.f.h;d.S=function(a){I.push(a);return d};d.ready=d.S;d.fa=function(a){O(a);return d};d.config=d.fa;d.K=function(a,b,c){a&&d(b,c);return d};d.conditionally=d.K;d.l=function(a,b){T.X(a,b);return d};d.alias=d.l;d.h=function(a,b){var c;switch(k(a,!0)){case "string":case "dependency":return d(C(a),b);case "array":for(c=a.length;c--;)a[c]=C(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");
}};d.css=d.h;d.h.K=function(a,b,c){a&&d.h(b,c);return d};d.h.conditionally=d.h.K;d.h.l=function(a,b){return d.l(a,C(b))};d.h.alias=d.h.l;g.initialUsing&&d.f(g.initialUsing);g.initialStyleUsing&&d.f.f(g.initialStyleUsing);return d})();
