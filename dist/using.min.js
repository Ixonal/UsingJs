/*

UsingJs script loader and dependency tracker
Copyright 2013-2016 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(n){function w(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,h,f,d;h=1;for(d=arguments.length;h<d;h++)if(c=arguments[h])for(f in c)b[f]=c[f];return b}function y(a){var b=arguments[0],c,h,f,d,e;if(!b||b.constructor!==J)throw Error("The mergee must be an array.");h=1;for(d=arguments.length;h<d;h++){c=arguments[h];if(!c||c.constructor!==J)throw Error("The merger must be an array.");f=0;for(e=c.length;f<e;f++)b.push(c[f])}}function B(a,
b){for(var c=0,h=a.length;c<h;c++)if(a[c]===b)return c;return-1}function C(a,b){for(var c=0,h=a.length;c<h;c++)if(a[c].matches(b))return c;return-1}function k(a,b){return null===a?"null":a===n?"undefined":"object"===typeof a?"[object Array]"===Object.prototype.toString.call(a)?b?"array":0<a.length?"array<"+k(a[0])+">":"array<object>":a.constructor===g.RegExp?"regexp":a.constructor===g.Date?"date":a.src?"dependency":"object":typeof a}function K(a){e=w({},S,e,a);if(!e.browser){var b=e,c;c={name:"unknown",
version:null};var h,f=3,d,x;if(g.navigator){if(h=T.exec(g.navigator.userAgent)){d=u.createElement("div");for(x=d.getElementsByTagName("i");d.innerHTML="\x3c!--[if gt IE "+ ++f+"]><i></i><![endif]--\x3e",x[0];);c.name="ie";c.version=4<f?f:+(h[2]||h[4])}else if(h=U.exec(g.navigator.userAgent))c.name="cr",c.version=+h[1];else if(h=V.exec(g.navigator.userAgent))c.name="ff",c.version=+h[1];else if(h=W.exec(g.navigator.userAgent))c.name="sf",c.version=+h[1];c={browser:c}}else c={browser:c};w(b,c)}e.environment=
"undefined"!==typeof g.module&&this.module!==g.module?"nd":g.document?"wb":"ww";a:{d=u.getElementsByTagName("script");var p=["using.js","using.min.js",e.srcName],k,b=0;for(h=d.length;b<h;b++)for(x=d[b].src,c=0,f=p.length;c<f;c++)if((k=p[c])&&x.substr(x.length-k.length,k.length)===k){b=d[b];break a}b=null}var m,t,r,n;b&&(m=b.getAttribute("data-script-root")||a&&a.scriptRoot||e.scriptRoot,t=b.getAttribute("data-style-root")||a&&a.styleRoot||e.styleRoot,r=b.getAttribute("data-using"),n=b.getAttribute("data-using-css"));
m&&"/"!==m.substr(m.length-1,1)&&(m+="/");e.scriptRoot=m||"/";t&&"/"!==t.substr(t.length-1,1)&&(t+="/");e.styleRoot=t||"/";r&&(e.initialUsing=g.eval("("+r+")"));n&&(e.initialStyleUsing=g.eval("("+n+")"))}function L(a){e.debug&&g.console&&g.console.warn(a)}function z(a){switch(k(a)){case "string":return X.test(a)?"js":Y.test(a)?"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?"js":a.type||z(a.src)}}function M(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}
function A(a){var b;switch(k(a,!0)){case "string":a=M(a);break;case "dependency":a.noExtension||(a.src=M(a.src));a.type="css";break;case "array":for(b=a.length;b--;)a[b]=A(a[b])}return a}function N(){return"ie"===e.browser.name&&10>=e.browser.version}function Z(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function O(a,b,c){b=b.split(/[\.\/\\]+/);var h,d;h=0;for(d=b.length-1;h<d;h++)a=a[b[h]]=a[b[h]]||{};a[b[b.length-
1]]=c}function r(a,b,c,h,d,l,g){this.src=a;this.type=b||z(a);this.i=h;this.o=c;this.j=[];this.f=[];this.b=[];this.l={};this.I=g;d&&(this.name=d);this.w=l!==n?l:e.minified}function D(){if(!E){E=!0;for(var a=F.length;a--;)F[a]()}}function aa(){if(!G){G=!0;var a=e.pollingTimeout;setTimeout(function c(){E||(m.K()?D():setTimeout(c,a));G=!1},a)}}function H(a,b,c,h){var f,l,g,p,q,n,t=m.empty();switch(k(a,!0)){case "function":d.M(a);return;case "string":case "dependency":case "array":f=P.u(a);break;default:throw Error("Valid dependencies must be entered");
}g=[];h?q=h:t||v?((q=m.O())||(q=m.T()),8===q.status&&(q.status=4)):N()?q=m.ba():"currentScript"in u&&(q=m.aa());for(l=f.length;l--;){p=m.m(f[l]);if(!p){switch(k(f[l],!0)){case "string":n=!1;p=new r(f[l],z(f[l]),!1,null);break;case "dependency":n=f[l].dependsOn,p=new r(f[l].src,z(f[l]),f[l].noExtension,f[l].backup,f[l].name,f[l].minified,f[l].exports)}m.G(p);n?function(){var a=p;H(f[l].dependsOn,function(){a.load()},null,a);a.F()}():p.F()}g.push(p)}if(q){for(l=g.length;l--;)q.H(g[l]),h&&g[l].C(b);
b&&!h&&q.C(b);c&&(q.name=c)}else{a=new r("<||usingContext||>"+ba++,"<||usingContext||>",a.noExtension,a.backup,c,a.minified);m.G(a);for(l=g.length;l--;)a.H(g[l]);b&&a.C(b);c&&(a.name=c);t||v||N()||Q.push(a)}"ie"===e.browser.name&&aa()}function d(a,b){H(a,b);return d}var g=this||(0,eval)("this"),e=g.using?g.using.config:null,J=g.Array,S={noConflict:!1,scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},Q=[],v=!1,u=g.document||{getElementsByTagName:function(){return[]}},
T=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,U=/Chrome\/(\d+)/i,V=/Firefox\/(\d+)/i,W=/Safari\/(\d+)/i,X=/\.((js)|(jscript))$/i,Y=/\.(css)$/i,R=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,I={8:!0,5:!0,6:!0,9:!0};K(e);var P={map:{},m:function(a){var b,c,d=k(a,!0);for(b in this.map)for(c=this.map[b].length;c--;)switch(d){case "string":switch(k(this.map[b][c],!0)){case "string":if(this.map[b][c]===a)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a)return this.map[b][c]}break;case "dependency":switch(k(this.map[b][c],
!0)){case "string":if(this.map[b][c]===a.src)return this.map[b][c];break;case "dependency":var f=this.map[b][c];if(f.src===a.src&&f.type===a.type&&f.conditionally===a.conditionally&&f.dependsOn===a.dependsOn&&f.noExtension===a.noExtension&&f.backup===a.backup)return this.map[b][c]}}return null},S:function(a,b){if("string"!==k(a))throw Error("The alias must be a string.");var c;c=k(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===c&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");
switch(c){case "array":d=[];for(c=b.length;c--;)y(d,this.u(b[c]));break;case "string":case "dependency":d=this.u(b);break;default:throw Error("Unknown dependency type found");}this.map[a]=d;return this},u:function(a){var b=[],c,d;switch(k(a,!0)){case "string":if(this.map[a])for(c=0,d=this.map[a].length;c<d;c++)y(b,this.u(this.map[a][c]));else return[a];break;case "dependency":return a.conditionally===n||!0===a.conditionally?(b=this.u(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===
a.length)return b;for(c=a.length;c--;)y(b,this.u(a[c]));0===b.length&&y(b,a);break;default:throw Error("Alias is not a recognized type.");}return 0===b.length?[a]:b}};w(r.prototype,{src:null,i:null,v:!1,type:"js",o:!1,status:0,f:null,b:null,j:null,a:null,l:null,name:null,w:!1,I:null,U:function(){if(6!==this.status){var a;for(a=this.f.length;a--;)this.f[a].matches(this)&&this.f.splice(a,1);for(a=this.b.length;a--;)this.b[a].matches(this)&&this.b.splice(a,1);delete this.f;delete this.b;delete this.j;
delete this.a;delete this.a;delete this.src;delete this.i;delete this.v;delete this.type;this.status=6}},V:function(){var a,b;if(4===this.status){this.status=7;for(a=this.b.length;a--;)8!==this.b[a].status&&this.b[a].s();for(a=this.j.length;a--;)switch(b=this.j[a](this.W(),this.l),k(b,!0)){case "object":w(this.l,b);break;default:b&&(this.l=b)}this.status=8;m.L("dependency-status-terminal");for(a=this.f.length;a--;)8!=this.f[a].status&&this.f[a].s();"<||page||>"!==this.type&&m.K()&&D()}},W:function(){var a,
b,c={};for(a=this.b.length;a--;)if(b=this.b[a],Z(b.l)){if(b.I){var d;a:{d=b.I.split(/[\.\/\\]+/);for(var f=g,l=void 0,e=void 0,l=0,e=d.length;l<e;l++)if(f=f[d[l]],f===n){d=null;break a}d=f}O(c,b.name||b.src,d)}}else O(c,b.name||b.src,b.l);return c},s:function(){if(4===this.status||9===this.status)9===this.status?m.K()&&D():this.N()&&this.V()},N:function(a){var b;if(8===this.status)return!0;if(4!==this.status)return!1;a=a||[];a.push(this);for(var c=this.b.length-1;0<=c;c--)if(b=this.b[c],-1!==B(a,
b)){if(e.debug){var d="Cyclic dependency found (non-terminal): \n",f;for(f=0;f<a.length;f++)d+=a[f]===b?"---\x3e":"    ",d+=(a[f].name||a[f].src)+"\n";d+="---\x3e"+(b.name||b.src);L(d)}}else if(!b.N(a))return!1;return!0},H:function(a){if(!a||a.constructor!==r)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===C(this.b,a)&&(a.f.push(this),this.b.push(a)),4===a.status&&this.s())},C:function(a){if("function"!==k(a))throw Error("dependency resolution callback function must be a function.");
7===this.status||8===this.status?a():this.j.push(a)},matches:function(a){var b=k(a);return"string"===b?this.src===a:"dependency"===b?this.src===a.src&&this.type==a.type:!1},da:function(a){if(!this.matches(a)){var b=C(this.b,a);0<=b&&this.b.splice(b,1);b=C(a.f,this);0<=b&&a.f.splice(b,1)}},resolve:function(){if(3===this.status){for(var a,b,c;(b=Q.shift())!==n;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=b.name);b.o&&(this.o=b.o);b.w!==n&&(this.w=b.w);for(a=b.b.length;a--;)c=
b.b[a],this.H(c),b.da(c);for(a=b.j.length;a--;)this.C(b.j[a]);m.P(b)}this.status=4;this.s()}},error:function(a){var b,c;this.status=9;m.L("dependency-status-terminal");b=this.v?this.i:this.src;"<||page||>"===b&&(b="page");"<||usingContext||>"===b&&(b="using context");c="UsingJs: An error has occurred when loading "+b;a&&(b=a.v?a.i:a.src,"<||page||>"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");e.debug&&g.console&&g.console.error(c);for(a=
this.f.length;a--;)b=this.f[a],b.status in I||b.error(this);this.s()},R:function(){var a=""+(this.v?this.i:this.src),b=(new Date).getTime(),c;(c=a)?(R.lastIndex=0,c=(c=R.exec(c))?g.location?c[1]!==g.location.protocol||c[2]!==g.location.host:!0:!1):c=!1;if(c)return a+(e.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+b);!this.o&&this.w&&-1===a.indexOf("min")&&(a+=".min");this.o||"<||usingContext||>"===this.type||"<||page||>"===this.type||a.substr(a.length-this.type.length)===this.type||(a+="."+this.type);
"/"===a.substr(0,1)&&(a=a.substr(1));e.cached&&e.version&&(a+=(0<=a.indexOf("?")?"&":"?")+"_v="+encodeURIComponent(e.version));e.cached||(a+=(0<=a.indexOf("?")?"&":"?")+"_t="+b);switch(this.type){case "js":return e.scriptRoot+a;case "css":return e.styleRoot+a;default:return"/"+a}},load:function(){var a=this,b,c;if(1===a.status){for(b=a.b.length;b--;){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("wb"==e.environment){if("js"===a.type)a.a=u.createElement("script"),
a.a.setAttribute("src",a.R()),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===a.type)a.a=u.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",a.R()),a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+a.type);b=function(){a.i&&!a.v?(L("Error occurred while loading "+a.src+", attempting to load "+a.i),a.v=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?
(a.a.addEventListener("load",function(){a.status=3;a.resolve()},!0),a.a.addEventListener("error",b,!0)):"ie"===e.browser.name&&9>e.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.resolve()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");u.getElementsByTagName("head")[0].appendChild(a.a)}else throw Error("This functionality is not yet implemented");
}},F:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==this.type?(this.status=1,this.load()):(this.status=4,this.s()))}});var m={c:{},A:0,Y:function(a){function b(a){var d=1,e,g=a.b.length,k;for(e=0;e<g;e++)k=a.b[e],-1===B(c,k)&&(d+=b(k)),c.push(k);return d}if(!a)return this.A;a=this.m(a);var c=[];return b(a)},X:function(a){function b(a){var d=a.status in I?1:0,e,g=a.b.length,k;for(e=0;e<g;e++)k=a.b[e],-1===B(c,k)&&(d+=b(k)),c.push(k);return d}a=a?this.m(a):this.O();var c=
[];return b(a)},B:{},ca:function(a,b){this.B[a]||(this.B[a]=[]);this.B[a].push(b)},L:function(a,b){var c=this.B[a];if(c)for(var d=0,e=c.length;d<e;d++)c[d].call(null,w({},b))},empty:function(){return 0===this.A},O:function(){return this.c["<||page||>"]},T:function(){var a=new r("<||page||>","<||page||>");this.G(a);a.F();return a},ba:function(){var a,b;for(a in this.c)if(b=this.c[a],b.a&&"interactive"===b.a.readyState)return b;return null},aa:function(){var a,b,c=u.currentScript;if(!c||!c.src)return null;
for(a in this.c)if(b=this.c[a],b.a&&b.a===c)return b;return null},m:function(a){switch(k(a)){case "string":return this.c[a]||null;case "dependency":return this.c[a.src]?this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},G:function(a){if(!this.m(a)){var b;switch(k(a)){case "string":b=new r(a,"js");b.F();this.c[a]=b;break;case "dependency":this.c[a.src]=a}}this.A++;return this},P:function(a){switch(k(a)){case "string":return this.P(this.m(a));case "dependency":delete this.c[a.src],
a.U()}this.A--;return this},K:function(){var a,b;for(a=this.c.length;a--;)if(b=this.c[a].status,b in I)return!1;return!0}},F=[],E=!1,G=!1,ba=0;d.Z=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);H(b,c,a);return d};d.amd=d.Z;d.h=function(a,b){v=!0;switch(k(a,!0)){case "function":a.call(g);break;default:d(a,b)}v=!1;return d};d.page=d.h;d.h.g=function(a,b){v=!0;switch(k(a,!0)){case "function":a.call(g);break;default:d.g(a,b)}v=!1;return d};d.h.css=d.h.g;d.h.h=function(a){if("function"!==typeof a)throw Error("callback must be a function");
m.ca("dependency-status-terminal",function(){a.call(null,m.Y(),m.X())})};d.h.progress=d.h.h;d.M=function(a){F.push(a);return d};d.ready=d.M;d.$=function(a){K(a);return d};d.config=d.$;d.J=function(a,b,c){a&&d(b,c);return d};d.conditionally=d.J;d.D=function(a,b){P.S(a,b);return d};d.alias=d.D;d.g=function(a,b){var c;switch(k(a,!0)){case "string":case "dependency":return d(A(a),b);case "array":for(c=a.length;c--;)a[c]=A(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");}};
d.css=d.g;d.g.J=function(a,b,c){a&&d.g(b,c);return d};d.g.conditionally=d.g.J;d.g.D=function(a,b){return d.D(a,A(b))};d.g.alias=d.g.D;e.noConflict||(g.using=d);e.initialUsing&&d.h(e.initialUsing);e.initialStyleUsing&&d.h.g(e.initialStyleUsing);return d})();
