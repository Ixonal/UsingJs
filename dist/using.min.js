/*

UsingJs script loader and dependency tracker
Copyright 2013-2016 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(r){function M(a,b){z[a]||(z[a]=[]);z[a].push(b)}function E(a,b){var c=z[a];if(c)for(var g=0,e=c.length;g<e;g++)c[g].call(null,w({},b))}function w(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,g,e,d;g=1;for(d=arguments.length;g<d;g++)if(c=arguments[g])for(e in c)b[e]=c[e];return b}function A(a){var b=arguments[0],c,g,e,d,f;if(!b||b.constructor!==N)throw Error("The mergee must be an array.");g=1;for(d=arguments.length;g<d;g++){c=
arguments[g];if(!c||c.constructor!==N)throw Error("The merger must be an array.");e=0;for(f=c.length;e<f;e++)b.push(c[e])}}function x(a,b){for(var c=0,g=a.length;c<g;c++)if(a[c]===b)return c;return-1}function F(a,b){for(var c=0,g=a.length;c<g;c++)if(a[c].matches(b))return c;return-1}function h(a,b){return null===a?"null":a===r?"undefined":"object"===typeof a?"[object Array]"===Object.prototype.toString.call(a)?b?"array":0<a.length?"array<"+h(a[0])+">":"array<object>":a.constructor===k.RegExp?"regexp":
a.constructor===k.Date?"date":a.src?"dependency":"object":typeof a}function O(a){f=w({},W,f,a);if(!f.browser){var b=w,c=f,g;g={name:"unknown",version:null};var e,d=3,n,y;if(k.navigator){if(e=X.exec(k.navigator.userAgent)){n=u.createElement("div");for(y=n.getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++d+"]><i></i><![endif]--\x3e",y[0];);g.name="ie";g.version=4<d?d:+(e[2]||e[4])}else if(e=Y.exec(k.navigator.userAgent))g.name="cr",g.version=+e[1];else if(e=Z.exec(k.navigator.userAgent))g.name=
"ff",g.version=+e[1];else if(e=aa.exec(k.navigator.userAgent))g.name="sf",g.version=+e[1];g={browser:g}}else g={browser:g};b(c,g)}f.environment="undefined"!==typeof k.module&&this.module!==k.module?"nd":k.document?"wb":"ww";a:{d=u.getElementsByTagName("script");y=["using.js","using.min.js",f.srcName];var h,b=0;for(g=d.length;b<g;b++)for(n=d[b].src.replace(/([#?][\s\w\\]+)+$/,""),c=0,e=y.length;c<e;c++)if((h=y[c])&&n.substr(n.length-h.length,h.length)===h){b=d[b];break a}b=null}var l,t,q,p;b&&(l=b.getAttribute("data-script-root")||
a&&a.scriptRoot||f.scriptRoot,t=b.getAttribute("data-style-root")||a&&a.styleRoot||f.styleRoot,q=b.getAttribute("data-using"),p=b.getAttribute("data-using-css"),f.scriptTag=b);(l=l||f.scriptRoot)&&"/"!==l.substr(l.length-1,1)&&(l+="/");f.scriptRoot=l||"/";t&&"/"!==t.substr(t.length-1,1)&&(t+="/");f.styleRoot=t||"/";q&&(f.initialUsing=k.eval("("+q+")"));p&&(f.initialStyleUsing=k.eval("("+p+")"))}function P(a){f.debug&&k.console&&k.console.warn(a)}function B(a){switch(h(a)){case "string":return ba.test(a)?
"js":ca.test(a)?"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?"js":a.type||B(a.src)}}function Q(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}function C(a){var b;switch(h(a,!0)){case "string":a=Q(a);break;case "dependency":a.noExtension||(a.src=Q(a.src));a.type="css";break;case "array":for(b=a.length;b--;)a[b]=C(a[b])}return a}function R(){return"ie"===f.browser.name&&10>=f.browser.version}function da(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===
Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function S(a,b,c){b=b.split(/[\.\/\\]+/);var g,d;g=0;for(d=b.length-1;g<d;g++)a=a[b[g]]=a[b[g]]||{};a[b[b.length-1]]=c}function q(a,b,c,d,e,m,n){this.src=a;this.type=b||B(a);this.i=d;this.s=c;this.j=[];this.F=[];this.g=[];this.b=[];this.l={};this.K=n;e&&(this.name=e);this.D=m!==r?m:f.minified}function G(){if(!H){H=!0;for(var a=I.length;a--;)I[a]()}}function ea(){if(!J){J=!0;var a=f.pollingTimeout;setTimeout(function c(){H||
(l.O()?G():setTimeout(c,a));J=!1},a)}}function K(a,b,c,g){var e,m,n,k,p,r,t=l.empty();switch(h(a,!0)){case "function":d.W(a);return;case "string":case "dependency":case "array":e=T.v(a);break;default:throw Error("Valid dependencies must be entered");}n=[];g?p=g:t||v?p=l.I():R()?(p=l.la())||(p=l.I()):"currentScript"in u&&((p=l.ka())||(p=l.I()));for(m=e.length;m--;){k=l.o(e[m]);if(!k){switch(h(e[m],!0)){case "string":r=!1;k=new q(e[m],B(e[m]),!1,null);break;case "dependency":r=e[m].dependsOn,k=new q(e[m].src,
B(e[m]),e[m].noExtension,e[m].backup,e[m].name,e[m].minified,e[m].exports)}l.P(k);r?function(){var a=k;K(e[m].dependsOn,function(){a.load()},null,a);a.C()}():k.C()}n.push(k)}if(p){for(m=n.length;m--;)p.J(n[m]),g&&n[m].A(b,n);b&&!g&&p.A(b,n);c&&(p.name=c)}else{a=new q("<||usingContext||>"+fa++,"<||usingContext||>",a.noExtension,a.backup,c,a.minified);l.P(a);for(m=n.length;m--;)a.J(n[m]);b&&a.A(b,n);c&&(a.name=c);a.C();t||v||R()||U.push(a)}"ie"===f.browser.name&&ea()}function d(a,b){K(a,b);return d}
var k=this||(0,eval)("this"),f=k.using?k.using.config:null,N=k.Array,W={scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},U=[],v=!1,u=k.document||{getElementsByTagName:function(){return[]}},X=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,Y=/Chrome\/(\d+)/i,Z=/Firefox\/(\d+)/i,aa=/Safari\/(\d+)/i,ba=/\.((js)|(jscript))$/i,ca=/\.(css)$/i,V=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,p={},D={},L={};p[8]=!0;p[5]=!0;p[6]=!0;p[9]=!0;D[4]=!0;D[7]=!0;D[8]=!0;L[7]=!0;L[8]=!0;var z={};O(f);var T=
{map:{},o:function(a){var b,c,d=h(a,!0);for(b in this.map)for(c=this.map[b].length;c--;)switch(d){case "string":switch(h(this.map[b][c],!0)){case "string":if(this.map[b][c]===a)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a)return this.map[b][c]}break;case "dependency":switch(h(this.map[b][c],!0)){case "string":if(this.map[b][c]===a.src)return this.map[b][c];break;case "dependency":var e=this.map[b][c];if(e.src===a.src&&e.type===a.type&&e.conditionally===a.conditionally&&
e.dependsOn===a.dependsOn&&e.noExtension===a.noExtension&&e.backup===a.backup)return this.map[b][c]}}return null},ba:function(a,b){if("string"!==h(a))throw Error("The alias must be a string.");var c;c=h(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===c&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");switch(c){case "array":d=[];for(c=b.length;c--;)A(d,this.v(b[c]));break;case "string":case "dependency":d=
this.v(b);break;default:throw Error("Unknown dependency type found");}this.map[a]=d;return this},v:function(a){var b=[],c,d;switch(h(a,!0)){case "string":if(this.map[a])for(c=0,d=this.map[a].length;c<d;c++)A(b,this.v(this.map[a][c]));else return[a];break;case "dependency":return a.conditionally===r||!0===a.conditionally?(b=this.v(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===a.length)return b;for(c=a.length;c--;)A(b,this.v(a[c]));0===b.length&&A(b,a);break;default:throw Error("Alias is not a recognized type.");
}return 0===b.length?[a]:b}};w(q.prototype,{src:null,i:null,w:!1,type:"js",s:!1,status:0,g:null,b:null,j:null,F:null,a:null,l:null,name:null,D:!1,K:null,S:function(){if(6!==this.status){var a;for(a=this.g.length;a--;)this.g[a].matches(this)&&this.g.splice(a,1);for(a=this.b.length;a--;)this.b[a].matches(this)&&this.b.splice(a,1);delete this.g;delete this.b;delete this.j;delete this.a;delete this.a;delete this.src;delete this.i;delete this.w;delete this.type;this.status=6}},da:function(){var a;if(4===
this.status){this.status=7;for(a=this.b.length;a--;)8!==this.b[a].status&&this.b[a].u();this.N();this.status=8;this.a&&(this.a.complete=!0);E("dependency-status-terminal");for(a=this.g.length;a--;){var b=this.g[a];8!=b.status?b.u():b.N()}"<||page||>"!==this.type&&l.O()&&G()}},aa:function(a){switch(h(a,!0)){case "object":w(this.l,a);break;default:a&&(this.l=a)}},ea:function(a){var b,c,d={};a=a||this.b;for(b=a.length;b--;)if(c=a[b],da(c.l)){if(c.K){var e;a:{e=c.K.split(/[\.\/\\]+/);for(var f=k,n=void 0,
h=void 0,n=0,h=e.length;n<h;n++)if(f=f[e[n]],f===r){e=null;break a}e=f}S(d,c.name||c.src,e)}}else S(d,c.name||c.src,c.l);return d},u:function(){if(4===this.status||9===this.status)9===this.status?l.O()&&G():this.Y()&&this.da()},R:function(a){var b,c=this.b.length;a=a||[];for(a.push(this);c--;)if(b=this.b[c],-1!==x(a,b)){if(f.debug){var d="Cyclic dependency found (non-terminal): \n",e;for(e=0;e<a.length;e++)d+=a[e]===b?"---\x3e":"    ",d+=(a[e].name||a[e].src)+"\n";d+="---\x3e"+(b.name||b.src);P(d)}}else if(!b.X())return!1;
return!0},Y:function(a){return this.status in D&&this.R(a)},X:function(a){return this.status in L&&this.R(a)},J:function(a){if(!a||a.constructor!==q)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===F(this.b,a)&&(a.g.push(this),this.b.push(a)),4===a.status&&this.u())},N:function(a,b){a=(a||this.j).slice(0);b=(b||this.F).slice(0);if(this.Y())for(var c,d,e;(c=a.pop())&&(d=b.pop());){try{e=c.call(null,this.ea(d),this.l)}catch(f){this.error()}this.aa(e);c=x(this.j,
c);-1<c&&(this.j.splice(c,1),this.F.splice(c,1))}else for(d=a.length;d--;)this.A(a[d])},A:function(a,b){if("function"!==h(a))throw Error("dependency resolution callback function must be a function.");this.X()?this.N([a],[b]):-1===x(this.j,a)&&(this.j.push(a),this.F.push(b))},matches:function(a){var b=h(a);return"string"===b?this.src===a:"dependency"===b?this.src===a.src&&this.type==a.type:!1},ma:function(a){if(!this.matches(a)){var b=F(this.b,a);0<=b&&this.b.splice(b,1);b=F(a.g,this);0<=b&&a.g.splice(b,
1)}},resolve:function(){if(3===this.status){for(var a,b,c;(b=U.shift())!==r;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=b.name);b.s&&(this.s=b.s);b.D!==r&&(this.D=b.D);b.i&&(this.i=b.i);b.l&&this.aa(b.l);for(a=b.b.length;a--;)c=b.b[a],this.J(c),b.ma(c);for(a=b.j.length;a--;)this.A(b.j[a],b.F[a]);l.Z(b);b.S()}this.status=4;this.u()}},error:function(a){var b,c;this.status=9;E("dependency-status-terminal");E("dependency-failed",{ca:this});b=this.w?this.i:this.src;"page"===b&&
(b="page");"<||usingContext||>"===b&&(b="using context");c="UsingJs: An error has occurred when loading "+b;a&&(b=a.w?a.i:a.src,"page"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");f.debug&&k.console&&k.console.error(c);for(a=this.g.length;a--;)b=this.g[a],b.status in p||b.error(this);this.u()},$:function(){var a=""+(this.w?this.i:this.src),b=(new Date).getTime(),c;(c=a)?(V.lastIndex=0,c=(c=V.exec(c))?k.location?c[1]!==k.location.protocol||
c[2]!==k.location.host:!0:!1):c=!1;if(c)return a+(f.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+b);!this.s&&this.D&&-1===a.indexOf("min")&&(a+=".min");this.s||"<||usingContext||>"===this.type||"<||page||>"===this.type||a.substr(a.length-this.type.length)===this.type||(a+="."+this.type);"/"===a.substr(0,1)&&(a=a.substr(1));f.cached&&f.version&&(a+=(0<=a.indexOf("?")?"&":"?")+"_v="+encodeURIComponent(f.version));f.cached||(a+=(0<=a.indexOf("?")?"&":"?")+"_t="+b);switch(this.type){case "js":return f.scriptRoot+
a;case "css":return f.styleRoot+a;default:return"/"+a}},load:function(){var a=this,b,c;if(1===a.status){for(b=a.b.length;b--;){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("wb"==f.environment){if("js"===a.type)a.a=u.createElement("script"),a.a.setAttribute("src",a.$()),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===a.type)a.a=u.createElement("link"),a.a.setAttribute("type","text/css"),
a.a.setAttribute("href",a.$()),a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+a.type);b=function(){a.i&&!a.w?(P("Error occurred while loading "+a.src+", attempting to load "+a.i),a.w=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.resolve()},!0),a.a.addEventListener("error",b,!0)):"ie"===f.browser.name&&9>f.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||
"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.resolve()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");a.a.na=a;f.scriptTag?f.scriptTag.parentElement.appendChild(a.a):u.getElementsByTagName("body")[0].appendChild(a.a)}else throw Error("This functionality is not yet implemented");}},C:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==this.type?(this.status=1,this.load()):
(this.status=4,this.u()))}});var l={c:{},G:0,ga:function(a){function b(a){var d=1,f,k=a.b.length,h;for(f=0;f<k;f++)h=a.b[f],-1===x(c,h)&&(d+=b(h)),c.push(h);return d}if(!a)return this.G;a=this.o(a);var c=[];return b(a)},fa:function(a){function b(a){var d=a.status in p?1:0,f,k=a.b.length,h;for(f=0;f<k;f++)h=a.b[f],-1===x(c,h)&&(d+=b(h)),c.push(h);return d}a=a?this.o(a):this.I();var c=[];return b(a)},H:null,B:[],ha:function(a){this.B.push(a);this.H&&this.T()},T:function(){for(var a=0,b=this.B.length;a<
b;a++)this.B[a].call(null,this.H.name||this.H.src);this.B.splice(0,this.B.length)},empty:function(){return 0===this.G},I:function(){if(this.c["<||page||>"])return this.c["<||page||>"];var a=new q("page","<||page||>");this.c["<||page||>"]=a;a.C();return a},la:function(){var a=u.getElementsByTagName("script"),b;for(b=0;b<a.length;b++)if("interactive"===a[b].readyState)return this.M(a[b]);return null},ka:function(){return this.M(u.currentScript)},pa:function(){var a=u.getElementsByTagName("script");
return this.M(a[a.length-1])},M:function(a){if(!a)return null;for(var b in this.c){var c=this.c[b];if(c.a&&c.a===a)return c}return null},o:function(a){switch(h(a)){case "string":return this.c[a]||null;case "dependency":return this.c[a.src]?this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},P:function(a){if(!this.o(a)){var b;switch(h(a)){case "string":b=new q(a,"js");b.C();this.c[a]=b;break;case "dependency":this.c[a.src]=a}}this.G++;return this},Z:function(a){switch(h(a)){case "string":return this.Z(this.o(a));
case "dependency":delete this.c[a.src],a.S()}this.G--;return this},oa:function(a){"array"!==h(a,!0)&&(a=[a]);for(var b=a.length;b--;)switch(h(a[b],!0)){case "string":if(!this.c[a])return!1;break;case "object":if(!this.c[a.src])return!1}return!0},O:function(){var a,b;for(a=this.c.length;a--;)if(b=this.c[a].status,b in p)return!1;return!0}},I=[],H=!1,J=!1;M("dependency-failed",function(a){l.H=a.ca;l.T()});var fa=0;d.ia=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);K(b,c,a);return d};d.amd=
d.ia;d.U=function(a){if("function"!==typeof a)throw Error("callback must be a function");l.ha(a)};d.failure=d.U;d.V=function(a){if("function"!==typeof a)throw Error("callback must be a function");M("dependency-status-terminal",function(){a.call(null,l.ga(),l.fa())})};d.progress=d.V;d.f=function(a,b){v=!0;switch(h(a,!0)){case "function":a.call(k);break;default:d(a,b)}v=!1;return d};d.page=d.f;d.f.f=function(a,b){v=!0;switch(h(a,!0)){case "function":a.call(k);break;default:d.h(a,b)}v=!1;return d};d.f.css=
d.f.f;d.f.m=function(a){return d.V(a)};d.f.progress=d.f.m;d.f.h=function(a){return d.U(a)};d.f.failure=d.f.h;d.W=function(a){I.push(a);return d};d.ready=d.W;d.ja=function(a){O(a);return d};d.config=d.ja;d.L=function(a,b,c){a&&d(b,c);return d};d.conditionally=d.L;d.m=function(a,b){T.ba(a,b);return d};d.alias=d.m;d.h=function(a,b){var c;switch(h(a,!0)){case "string":case "dependency":return d(C(a),b);case "array":for(c=a.length;c--;)a[c]=C(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");
}};d.css=d.h;d.h.L=function(a,b,c){a&&d.h(b,c);return d};d.h.conditionally=d.h.L;d.h.m=function(a,b){return d.m(a,C(b))};d.h.alias=d.h.m;k.using=d;f.initialUsing&&d.f(f.initialUsing);f.initialStyleUsing&&d.f.f(f.initialStyleUsing);return d})();
