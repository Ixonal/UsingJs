/*
UsingJs script loader and dependency tracker
Copyright 2013 Benjamin McGregor
Released under the MIT Licence
*/
(function(f,g){function B(){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var a=arguments[0],b,c,d;for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)a[d]=b[d];return a}function v(){var a=arguments[0],b,c,d;if(!a||a.constructor!==Array)throw Error("The mergee must be an array.");for(c=1;c<arguments.length;c++){b=arguments[c];if(!b||b.constructor!==Array)throw Error("The merger must be an array.");if(b)for(d=0;d<b.length;d++)a.push(b[d])}}function w(a,
b){for(var c=0;c<a.length;c++)if(a[c].matches(b))return c;return-1}function h(a,b){return typeof a===C?a.constructor===f.Array?b?p:0<a.length?p+"<"+h(a[0])+">":p+"<object>":a.constructor===f.RegExp?I:a.constructor===f.Date?J:a.src?k:C:typeof a}function D(){var a=B,b=K,c=g,d;if(f.navigator){d={name:L,version:null};var e;if(e=M.exec(f.navigator.userAgent))d.name=x,d.version=+e[1];else if(e=N.exec(f.navigator.userAgent))d.name=O,d.version=+e[1];else if(e=P.exec(f.navigator.userAgent))d.name=Q,d.version=
+e[1];else if(e=R.exec(f.navigator.userAgent))d.name=S,d.version=+e[1];d={g:d}}else d={g:null};g=a({},b,c,d);a:{c=q.getElementsByTagName("script");e=["using.js","using.min.js",g.P];for(a=0;a<c.length;a++)for(d=c[a].src,b=0;b<e.length;b++)if(d.substr(d.length-e[b].length,e[b].length)===e[b]){d=c[a];break a}d=null}if(null===d)throw Error("Could not locate the using.js script include. \nPlease specify the name of the source file in the configuration.");a=d.getAttribute("data-script-root");b=d.getAttribute("data-style-root");
c=d.getAttribute("data-using");d=d.getAttribute("data-using-css");a&&"/"!==a.substr(a.length-1,1)&&(a+="/");g.A=a||"/";b&&"/"!==b.substr(b.length-1,1)&&(b+="/");g.C=b||"/";c&&(g.t=f.eval("("+c+")"));d&&(g.s=f.eval("("+d+")"))}function E(a,b){var c=""+a,d;d=c&&(7<=c.length&&"http://"===c.substr(0,7).toLowerCase()||8<=c.length&&"https://"===c.substr(0,8).toLowerCase())?f.location?(d=T.exec(c))&&(d[1]!==f.location.protocol||d[2]!==f.location.host):!0:!1;if(d)return c;c.substr(c.length-b.length)===b||
(c+="."+b);"/"===c.substr(0,1)&&(c=c.substr(1));switch(b){case l:return g.A+c;case n:return g.C+c;default:return"/"+c}}function F(a){switch(h(a)){case m:return U.test(a)?l:V.test(a)?n:l;case k:return a.type||l}}function G(a,b){a.substr(a.length-(b.length+1),b.length+1)!=="."+b&&(a+="."+b);return a}function t(a){var b;switch(h(a,!0)){case m:a=G(a,n);break;case k:a.noExtension||(a.src=G(a.src,n));a.type=n;break;case p:for(b=a.length-1;0<=b;b--)a[b]=t(a[b])}return a}function r(a,b){this.src=a;this.type=
b||l;this.f=[];this.d=[];this.b=[]}function e(a,b){var c,d,f,l,n,q=s.empty();switch(h(a,!0)){case "function":return e.v(a);case m:case k:case p:c=H.j(a);break;default:throw Error("Valid dependencies must be entered");}f=[];q?(n=new r(y,y),n.l()):g.g.name===x&&10>=g.g.version&&(n=s.H());for(d=c.length-1;0<=d;d--){l=s.m(c[d]);if(!l){switch(h(c[d],!0)){case m:l=new r(c[d],F(c[d]));break;case k:l=new r(c[d].src,F(c[d]))}s.r(l);l.l()}f.push(l)}if(n){for(d=f.length-1;0<=d;d--)n.p(f[d]);b&&n.o(b)}else{c=
new r(u+W++,u);s.r(c);for(d=f.length-1;0<=d;d--)c.p(f[d]);b&&c.o(b);c.l();q||z.push(c)}return e}var K={I:!1,A:"/",C:"/"},z=[],q=f.document,C="object",m="string",p="array",k="dependency",J="date",I="regexp",l="js",n="css",u="usingContext",y="page",M=/MSIE\s*(\d+)/i,N=/Chrome\/(\d+)/i,P=/Firefox\/(\d+)/i,R=/Safari\/(\d+)/i,U=/\.((js)|(jscript))$/i,V=/\.(css)$/i,T=/([a-zA-Z0-9\.]*:)\/\/([^\/]+)\/?/,L="unknown",x="ie",Q="ff",O="cr",S="sf";D();var H={map:{},m:function(a){var b,c,d=h(a,!0);for(b in this.map)for(c=
this.map[b].length-1;0<=c;c--)switch(d){case m:switch(h(this.map[b][c],!0)){case m:if(this.map[b][c]===a)return this.map[b][c];break;case k:if(this.map[b][c].src===a)return this.map[b][c]}break;case k:switch(h(this.map[b][c],!0)){case m:if(this.map[b][c]===a.src)return this.map[b][c];break;case k:if(this.map[b][c].src===a.src&&this.map[b][c].type===a.type&&this.map[b][c].h===a.h&&this.map[b][c].M===a.M&&this.map[b][c].J===a.J)return this.map[b][c]}}return null},D:function(a,b){if(h(a)!==m)throw Error("The alias must be a string.");
var c;c=h(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if(c===k&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");switch(c){case p:d=[];for(c=b.length-1;0<=c;c--)v(d,this.j(b[c]));break;case m:case k:d=this.j(b)}this.map[a]=d;return this},j:function(a){var b=[],c;switch(h(a,!0)){case m:if(this.map[a])for(c=0;c<this.map[a].length;c++)v(b,this.j(this.map[a][c]));else return[a];break;case k:return[a];case p:for(c=a.length-1;0<=
c;c--)v(b,this.j(a[c]));break;default:throw Error("Alias is not a recognized type.");}return 0===b.length?[a]:b}};B(r.prototype,{src:null,type:l,B:!1,status:0,d:null,b:null,f:null,a:null,G:function(){if(6!==this.status){var a;for(a=this.d.length-1;0<=a;a--)this.d[a].matches(this)&&this.d.splice(a,1);for(a=this.b.length-1;0<=a;a--)this.b[a].matches(this)&&this.b.splice(a,1);delete this.d;delete this.b;delete this.f;delete this.a;delete this.a;delete this.src;delete this.type;delete this.B;this.status=
6}},i:function(){if(4===this.status){var a;if(this.u()){this.status=7;for(a=0;a<this.b.length;a++)this.b[a].i();for(a=0;a<this.f.length;a++)this.f[a]();for(a=0;a<this.d.length;a++)this.d[a].i();if(s.L())for(a=0;a<A.length;a++)A[a]()}}},u:function(){if(4!==this.status&&7!==this.status)return!1;for(var a=this.b.length-1;0<=a;a--)if(!this.b[a].u())return!1;return!0},p:function(a){if(!a||a.constructor!==r)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===w(this.b,
a)&&(a.d.push(this),this.b.push(a)),4===a.status&&this.i())},o:function(a){if("function"!==h(a))throw Error("dependency resolution callback function must be a function.");4===this.Q?a():this.f.push(a)},matches:function(a){var b=h(a);if(b===m)return this.src===a;if(b===k)return this.src===a.src&&this.type==a.type},K:function(a){if(!this.matches(a)){var b=w(this.b,a);0<=b&&this.b.splice(b,1);b=w(a.d,this);0<=b&&a.d.splice(b,1)}},n:function(){if(3===this.status){var a,b,c,d,e;c=z.splice(0,z.length);
for(a=0;a<c.length;a++)if(d=c[a],d.type===u&&6!==d.status){for(b=d.b.length-1;0<=b;b--)e=d.b[b],this.p(e),d.K(e);for(b=d.f.length-1;0<=b;b--)this.o(d.f[b]);s.w(d)}this.status=4;6!==this.status&&this.i()}},load:function(){var a=this;a.status=2;if(a.type===l)a.a=q.createElement("script"),a.a.src=E(a.src,a.type),a.a.type="text/javascript",a.a.defer=!1,a.a.async=!0;else if(a.type===n)a.a=q.createElement("link"),a.a.type="text/css",a.a.href=E(a.src,a.type),a.a.rel="stylesheet";else throw Error("Attempting to load an unsupported file type: "+
this.type);g.g.name===x&&9>g.g.version?a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.n()}:a.a.addEventListener("load",function(){a.status=3;a.n()},!0);q.getElementsByTagName("head")[0].appendChild(this.a)},l:function(){if(0!==this.status)throw Error("Attempting to initiate a previously initiated dependency.");this.status=1;this.type!==u&&this.type!==y?this.load():this.i()}});var s={c:{},q:0,N:function(){for(var a in this.c)this.c[a].B=
!1},empty:function(){return 0===this.q},H:function(){var a,b;for(a in this.c)if(b=this.c[a],b.a&&"interactive"===b.a.readyState)return b;return null},m:function(a){switch(h(a)){case m:return this.c[a]||null;case k:return this.c[a.src]||null;default:return null}},r:function(a){if(!this.m(a)){var b;switch(h(a)){case m:b=new r(a,l);b.l();this.c[a]=b;break;case k:this.c[a.src]=a}}this.q++;return this},w:function(a){switch(h(a)){case m:return this.w(this.m(a));case k:delete this.c[a.src],a.G()}return this},
n:function(){for(var a in this.c)this.c[a].O||this.c[a].n()},L:function(){var a,b;for(a in this.c)if(b=this.c[a].status,7!==b&&5!==b&&6!==b)return!1;return!0}},A=[],W=0;e.v=function(a){A.push(a)};e.ready=e.v;e.F=function(){D();return e};e.config=e.F;e.h=function(a,b,c){a&&e(b,c);return e};e.conditionally=e.h;e.k=function(a,b){H.D(a,b);return e};e.alias=e.k;e.e=function(a,b){var c;switch(h(a,!0)){case m:case k:return e(t(a),b);case p:for(c=a.length-1;0<=c;c--)a[c]=t(a[c]);return e(a,b);default:throw Error("Valid dependencies must be entered");
}};e.css=e.e;e.e.h=function(a,b,c){a&&e.e(b,c);return e};e.css.conditionally=e.e.h;e.e.k=function(a,b){return e.k(a,t(b))};e.css.alias=e.e.k;g.I||(f.using=e);g.t&&e(g.t);g.s&&e.e(g.s);return e})(window||global,(window||global).using?using.configuration:null);
