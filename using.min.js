/*

UsingJs script loader and dependency tracker
Copyright 2013-2015 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(q){function r(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],d,f,e,c;f=1;for(c=arguments.length;f<c;f++)if(d=arguments[f])for(e in d)b[e]=d[e];return b}function w(a){var b=arguments[0],d,f,e,c,h;if(!b||b.constructor!==x)throw Error("The mergee must be an array.");f=1;for(c=arguments.length;f<c;f++){d=arguments[f];if(!d||d.constructor!==x)throw Error("The merger must be an array.");e=0;for(h=d.length;e<h;e++)b.push(d[e])}}function A(a,
b){for(var d=0,f=a.length;d<f;d++)if(a[d].matches(b))return d;return-1}function l(a,b){return null===a?"null":a===q?"undefined":"object"===typeof a?"[object Array]"===Object.prototype.toString.call(a)?b?"array":0<a.length?"array<"+l(a[0])+">":"array<object>":a.constructor===k.RegExp?"regexp":a.constructor===k.Date?"date":a.src?"dependency":"object":typeof a}function G(a){h=r({},Q,h,a);if(!h.browser){a=h;var b;b={name:"unknown",version:null};var d,f=3,e,c;if(k.navigator)if(d=R.exec(k.navigator.userAgent)){e=
t.createElement("div");for(c=e.getElementsByTagName("i");e.innerHTML="\x3c!--[if gt IE "+ ++f+"]><i></i><![endif]--\x3e",c[0];);b.name="ie";b.version=4<f?f:+(d[2]||d[4])}else if(d=S.exec(k.navigator.userAgent))b.name="cr",b.version=+d[1];else if(d=T.exec(k.navigator.userAgent))b.name="ff",b.version=+d[1];else if(d=U.exec(k.navigator.userAgent))b.name="sf",b.version=+d[1];b={browser:b};r(a,b)}h.environment="undefined"!==typeof module&&this.N!==module?"nd":k.document?"wb":"ww";a:{e=t.getElementsByTagName("script");
var l=["using.js","using.min.js",h.srcName],n;a=0;for(d=e.length;a<d;a++)for(c=e[a].src,b=0,f=l.length;b<f;b++)if((n=l[b])&&c.substr(c.length-n.length,n.length)===n){f=e[a];break a}f=null}if(!f)throw Error("Could not locate the using.js script include. \nPlease specify the name of the source file in the configuration.");a=f.getAttribute("data-script-root");b=f.getAttribute("data-style-root");d=f.getAttribute("data-using");f=f.getAttribute("data-using-css");a&&"/"!==a.substr(a.length-1,1)&&(a+="/");
h.scriptRoot=a||"/";b&&"/"!==b.substr(b.length-1,1)&&(b+="/");h.styleRoot=b||"/";d&&(h.initialUsing=k.eval("("+d+")"));f&&(h.initialStyleUsing=k.eval("("+f+")"))}function H(a){h.debug&&k.console&&k.console.warn(a)}function I(a,b,d,f){a=""+a;var c=(new Date).getTime(),g;(g=a)?(J.lastIndex=0,g=(g=J.exec(g))?k.location?g[1]!==k.location.protocol||g[2]!==k.location.host:!0:!1):g=!1;if(g)return a+(h.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+c);!d&&f&&-1===a.indexOf("min")&&(a+=".min");d||"<||usingContext||>"===
b||"<||page||>"===b||a.substr(a.length-b.length)===b||(a+="."+b);"/"===a.substr(0,1)&&(a=a.substr(1));h.cached||(a=-1===a.indexOf("?")?a+("?_t="+c):a+("&_t="+c));switch(b){case "js":return h.scriptRoot+a;case "css":return h.styleRoot+a;default:return"/"+a}}function y(a){switch(l(a)){case "string":return V.test(a)?"js":W.test(a)?"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?"js":a.type||y(a.src)}}function K(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}
function z(a){var b;switch(l(a,!0)){case "string":a=K(a);break;case "dependency":a.noExtension||(a.src=K(a.src));a.type="css";break;case "array":for(b=a.length;b--;)a[b]=z(a[b])}return a}function L(){return"ie"===h.browser.name&&10>=h.browser.version}function X(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function M(a,b,d){b=b.split(/[\.\/\\]+/);var f,c;f=0;for(c=b.length-1;f<c;f++)a=a[b[f]]=a[b[f]]||{};a[b[b.length-
1]]=d}function u(a,b,d,f,c,g,k){this.src=a;this.type=b||y(a);this.f=f;this.k=d;this.g=[];this.d=[];this.b=[];this.i={};this.v=k;c&&(this.name=c);this.j=g!==q?g:h.minified}function B(){if(!C){C=!0;for(var a=D.length;a--;)D[a]()}}function Y(){if(!E){E=!0;var a=h.pollingTimeout;setTimeout(function d(){C||(p.w()?B():setTimeout(d,a));E=!1},a)}}function F(a,b,d,f){var e,g,k,n,m,q,r=p.empty();switch(l(a,!0)){case "function":c.ready(a);return;case "string":case "dependency":case "array":e=N.m(a);break;default:throw Error("Valid dependencies must be entered");
}k=[];f?m=f:r||v?(m=p.L(),m||(m=new u("<||page||>","<||page||>"),p.s(m),m.n()),8===m.status&&(m.status=4)):L()?m=p.K():"currentScript"in t&&(m=p.J());for(g=e.length;g--;){n=p.q(e[g]);if(!n){switch(l(e[g],!0)){case "string":q=!1;n=new u(e[g],y(e[g]),!1,null);break;case "dependency":q=e[g].dependsOn,n=new u(e[g].src,y(e[g]),e[g].noExtension,e[g].backup,e[g].name,e[g].minified,e[g].exports)}p.s(n);q?function(){var a=n;F(e[g].dependsOn,function(){a.load()},null,a);a.n()}():n.n()}k.push(n)}if(m){for(g=
k.length;g--;)m.u(k[g]),f&&k[g].o(b);b&&!f&&m.o(b);d&&(m.name=d)}else{a=new u("<||usingContext||>"+Z++,"<||usingContext||>",a.noExtension,a.backup,d,a.minified);p.s(a);for(g=k.length;g--;)a.u(k[g]);b&&a.o(b);d&&(a.name=d);a.n();r||v||L()||O.push(a)}"ie"===h.browser.name&&Y()}function c(a,b){F(a,b);return c}var k=this||(0,eval)("this"),h=k.using?c.configuration:null,x=k.Array,Q={noConflict:!1,scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},O=[],v=!1,t=k.document,R=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,
S=/Chrome\/(\d+)/i,T=/Firefox\/(\d+)/i,U=/Safari\/(\d+)/i,V=/\.((js)|(jscript))$/i,W=/\.(css)$/i,J=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,P={8:!0,5:!0,6:!0,9:!0};G(h);var N={map:{},q:function(a){var b,d,f=l(a,!0);for(b in this.map)for(d=this.map[b].length;d--;)switch(f){case "string":switch(l(this.map[b][d],!0)){case "string":if(this.map[b][d]===a)return this.map[b][d];break;case "dependency":if(this.map[b][d].src===a)return this.map[b][d]}break;case "dependency":switch(l(this.map[b][d],!0)){case "string":if(this.map[b][d]===
a.src)return this.map[b][d];break;case "dependency":var c=this.map[b][d];if(c.src===a.src&&c.type===a.type&&c.conditionally===a.conditionally&&c.dependsOn===a.dependsOn&&c.noExtension===a.noExtension&&c.backup===a.backup)return this.map[b][d]}}return null},C:function(a,b){if("string"!==l(a))throw Error("The alias must be a string.");var d;d=l(b,!0);var c;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===d&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");
switch(d){case "array":c=[];for(d=b.length;d--;)w(c,this.m(b[d]));break;case "string":case "dependency":c=this.m(b);break;default:throw Error("Unknown dependency type found");}this.map[a]=c;return this},m:function(a){var b=[],d,c;switch(l(a,!0)){case "string":if(this.map[a])for(d=0,c=this.map[a].length;d<c;d++)w(b,this.m(this.map[a][d]));else return[a];break;case "dependency":return a.conditionally===q||!0===a.conditionally?(b=this.m(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===
a.length)return b;for(d=a.length;d--;)w(b,this.m(a[d]));0===b.length&&w(b,a);break;default:throw Error("Alias is not a recognized type.");}return 0===b.length?[a]:b}};r(u.prototype,{src:null,f:null,h:!1,type:"js",k:!1,status:0,d:null,b:null,g:null,a:null,i:null,name:null,j:!1,v:null,G:function(){if(6!==this.status){var a;for(a=this.d.length;a--;)this.d[a].matches(this)&&this.d.splice(a,1);for(a=this.b.length;a--;)this.b[a].matches(this)&&this.b.splice(a,1);delete this.d;delete this.b;delete this.g;
delete this.a;delete this.a;delete this.src;delete this.f;delete this.h;delete this.type;this.status=6}},H:function(){var a,b;if(4===this.status){this.status=7;for(a=this.b.length;a--;)8!==this.b[a].status&&this.b[a].l();for(a=this.g.length;a--;)switch(b=this.g[a](this.I(),this.i),l(b,!0)){case "object":r(this.i,b);break;default:b&&(this.i=b)}this.status=8;for(a=this.d.length;a--;)8!=this.d[a].status&&this.d[a].l();"<||page||>"!==this.type&&p.w()&&B()}},I:function(){var a,b,d={};for(a=this.b.length;a--;)if(b=
this.b[a],X(b.i)){if(b.v){var c;a:{c=b.v.split(/[\.\/\\]+/);for(var e=k,g=void 0,h=void 0,g=0,h=c.length;g<h;g++)if(e=e[c[g]],e===q){c=null;break a}c=e}M(d,b.name||b.src,c)}}else M(d,b.name||b.src,b.i);return d},l:function(){if(4===this.status||9===this.status)9===this.status?p.w()&&B():this.A()&&this.H()},A:function(a){var b;if(8===this.status)return!0;if(4!==this.status)return!1;a=a||[];a.push(this);for(var d=this.b.length-1;0<=d;d--){b=this.b[d];var c;a:if(x.prototype.indexOf)c=x.prototype.indexOf.apply(a,
b);else{c=0;for(var e=a.length;c<e;c++)if(a[c]===b)break a;c=-1}if(-1!==c){if(h.debug){c="Cyclic dependency found (non-terminal): \n";for(e=0;e<a.length;e++)c+=a[e]===b?"---\x3e":"    ",c+=(a[e].name||a[e].src)+"\n";c+="---\x3e"+(b.name||b.src);H(c)}}else if(!b.A(a))return!1}return!0},u:function(a){if(!a||a.constructor!==u)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===A(this.b,a)&&(a.d.push(this),this.b.push(a)),4===a.status&&this.l())},o:function(a){if("function"!==
l(a))throw Error("dependency resolution callback function must be a function.");7===this.status||8===this.status?a():this.g.push(a)},matches:function(a){var b=l(a);return"string"===b?this.src===a:"dependency"===b?this.src===a.src&&this.type==a.type:!1},M:function(a){if(!this.matches(a)){var b=A(this.b,a);0<=b&&this.b.splice(b,1);b=A(a.d,this);0<=b&&a.d.splice(b,1)}},resolve:function(){if(3===this.status){for(var a,b,c;(b=O.shift())!==q;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=
b.name);b.k&&(this.k=b.k);b.j!==q&&(this.j=b.j);for(a=b.b.length;a--;)c=b.b[a],this.u(c),b.M(c);for(a=b.g.length;a--;)this.o(b.g[a]);p.B(b)}this.status=4;this.l()}},error:function(a){var b,c;this.status=9;b=this.h?this.f:this.src;"<||page||>"===b&&(b="page");"<||usingContext||>"===b&&(b="using context");c="UsingJs: An error has occurred when loading "+b;a&&(b=a.h?a.f:a.src,"<||page||>"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");h.debug&&
k.console&&k.console.error(c);for(a=this.d.length;a--;)b=this.d[a],b.status in P||b.error(this);this.l()},load:function(){var a=this,b,c;if(1===a.status){for(b=a.b.length;b--;){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("wb"==h.environment){if("js"===a.type)a.a=t.createElement("script"),a.a.setAttribute("src",I(a.h?a.f:a.src,a.type,a.k,a.j)),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===
a.type)a.a=t.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",I(a.h?a.f:a.src,a.type,a.k,a.j)),a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+a.type);b=function(){a.f&&!a.h?(H("Error occurred while loading "+a.src+", attempting to load "+a.f),a.h=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.resolve()},!0),a.a.addEventListener("error",b,!0)):"ie"===
h.browser.name&&9>h.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.resolve()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");t.getElementsByTagName("head")[0].appendChild(a.a)}else throw Error("This functionality is not yet implemented");}},n:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==
this.type?(this.status=1,this.load()):(this.status=4,this.l()))}});var p={c:{},r:0,empty:function(){return 0===this.r},L:function(){return this.c["<||page||>"]},K:function(){var a,b;for(a in this.c)if(b=this.c[a],b.a&&"interactive"===b.a.readyState)return b;return null},J:function(){var a,b,c=t.currentScript;if(!c.src)return null;for(a in this.c)if(b=this.c[a],b.a&&b.a===c)return b;return null},q:function(a){switch(l(a)){case "string":return this.c[a]||null;case "dependency":return this.c[a.src]?
this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},s:function(a){if(!this.q(a)){var b;switch(l(a)){case "string":b=new u(a,"js");b.n();this.c[a]=b;break;case "dependency":this.c[a.src]=a}}this.r++;return this},B:function(a){switch(l(a)){case "string":return this.B(this.q(a));case "dependency":delete this.c[a.src],a.G()}this.r--;return this},w:function(){var a,b;for(a=this.c.length;a--;)if(b=this.c[a].status,b in P)return!1;return!0}},D=[],C=!1,E=!1,Z=0;c.D=function(a,
b,d){2===arguments.length&&(d=b,b=a,a=null);F(b,d,a);return c};c.amd=c.D;c.page=function(a,b){v=!0;switch(l(a,!0)){case "function":a.call(k);break;default:c(a,b)}v=!1;return c};c.page=c.page;c.page.e=function(a,b){v=!0;switch(l(a,!0)){case "function":a.call(k);break;default:c.e(a,b)}v=!1;return c};c.page.css=c.page.e;c.ready=function(a){D.push(a);return c};c.ready=c.ready;c.F=function(a){G(a);return c};c.config=c.F;c.t=function(a,b,d){a&&c(b,d);return c};c.conditionally=c.t;c.p=function(a,b){N.C(a,
b);return c};c.alias=c.p;c.e=function(a,b){var d;switch(l(a,!0)){case "string":case "dependency":return c(z(a),b);case "array":for(d=a.length;d--;)a[d]=z(a[d]);return c(a,b);default:throw Error("Valid dependencies must be entered");}};c.css=c.e;c.e.t=function(a,b,d){a&&c.e(b,d);return c};c.e.conditionally=c.e.t;c.e.p=function(a,b){return c.p(a,z(b))};c.e.alias=c.e.p;h.noConflict||(k.using=c);h.initialUsing&&c.page(h.initialUsing);h.initialStyleUsing&&c.page.e(h.initialStyleUsing);return c})();
