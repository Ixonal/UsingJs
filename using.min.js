/*
UsingJs script loader and dependency tracker
Copyright 2013 Benjamin McGregor
Released under the MIT Licence
*/
(function(f,g,E){function F(){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var a=arguments[0],b,c,d;for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)a[d]=b[d];return a}function y(){var a=arguments[0],b,c,d;if(!a||a.constructor!==Array)throw Error("The mergee must be an array.");for(c=1;c<arguments.length;c++){b=arguments[c];if(!b||b.constructor!==Array)throw Error("The merger must be an array.");if(b)for(d=0;d<b.length;d++)a.push(b[d])}}function z(a,
b){for(var c=0;c<a.length;c++)if(a[c].matches(b))return c;return-1}function h(a,b){return typeof a===G?a.constructor===f.Array?b?n:0<a.length?n+"<"+h(a[0])+">":n+"<object>":a.constructor===f.RegExp?L:a.constructor===f.Date?M:a.src?k:G:typeof a}function H(){var a=F,b=N,c=g,d;if(f.navigator){d={name:O,version:null};var e;if(e=P.exec(f.navigator.userAgent))d.name=A,d.version=+e[1];else if(e=Q.exec(f.navigator.userAgent))d.name=R,d.version=+e[1];else if(e=S.exec(f.navigator.userAgent))d.name=T,d.version=
+e[1];else if(e=U.exec(f.navigator.userAgent))d.name=V,d.version=+e[1];d={g:d}}else d={g:null};g=a({},b,c,d);a:{c=w.getElementsByTagName("script");e=["using.js","using.min.js",g.P];for(a=0;a<c.length;a++)for(d=c[a].src,b=0;b<e.length;b++)if(d.substr(d.length-e[b].length,e[b].length)===e[b]){d=c[a];break a}d=null}if(null===d)throw Error("Could not locate the using.js script include. \nPlease specify the name of the source file in the configuration.");a=d.getAttribute("data-script-root");b=d.getAttribute("data-style-root");
c=d.getAttribute("data-using");d=d.getAttribute("data-using-css");a&&"/"!==a.substr(a.length-1,1)&&(a+="/");g.B=a||"/";b&&"/"!==b.substr(b.length-1,1)&&(b+="/");g.D=b||"/";c&&(g.u=f.eval("("+c+")"));d&&(g.t=f.eval("("+d+")"))}function I(a,b){var c=""+a,d;d=c&&(7<=c.length&&"http://"===c.substr(0,7).toLowerCase()||8<=c.length&&"https://"===c.substr(0,8).toLowerCase())?f.location?(d=W.exec(c))&&(d[1]!==f.location.protocol||d[2]!==f.location.host):!0:!1;if(d)return c;c.substr(c.length-b.length)===b||
(c+="."+b);"/"===c.substr(0,1)&&(c=c.substr(1));switch(b){case p:return g.B+c;case t:return g.D+c;default:return"/"+c}}function J(a,b){a.substr(a.length-(b.length+1),b.length+1)!=="."+b&&(a+="."+b);return a}function q(a){var b;switch(h(a,!0)){case l:a=J(a,t);break;case k:a.noExtension||(a.src=J(a.src,t));a.type=t;break;case n:for(b=a.length-1;0<=b;b--)a[b]=q(a[b])}return a}function u(a,b){this.src=a;this.type=b||p;this.f=[];this.d=[];this.b=[]}function e(a,b){var c,d,f,r,v,q=s.empty();switch(h(a,
!0)){case "function":return e.w(a);case l:case k:case n:c=K.l(a);break;default:throw Error("Valid dependencies must be entered");}f=[];q?(v=new u(B,B),v.j()):g.g.name===A&&10>=g.g.version&&(v=s.I());for(d=c.length-1;0<=d;d--){r=s.p(c[d]);if(!r){r=c[d];var m;a:{m=c[d];switch(h(m)){case l:m=X.test(m)?p:Y.test(m)?t:p;break a;case k:m=m.type||p;break a}m=void 0}r=new u(r,m);s.s(r);r.j()}f.push(r)}if(v){for(d=f.length-1;0<=d;d--)v.o(f[d]);b&&v.m(b)}else{c=new u(x+Z++,x);s.s(c);for(d=f.length-1;0<=d;d--)c.o(f[d]);
b&&c.m(b);c.j();q||C.push(c)}return e}var N={J:!1,B:"/",D:"/"},C=[],w=f.document,G="object",l="string",n="array",k="dependency",M="date",L="regexp",p="js",t="css",x="usingContext",B="page",P=/MSIE\s*(\d+)/i,Q=/Chrome\/(\d+)/i,S=/Firefox\/(\d+)/i,U=/Safari\/(\d+)/i,X=/\.((js)|(jscript))$/i,Y=/\.(css)$/i,W=/([a-zA-Z0-9\.]*:)\/\/([^\/]+)\/?/,O="unknown",A="ie",T="ff",R="cr",V="sf";H();var K={map:{},O:function(a){for(var b in this.F)if(this.F[b]===a)return b;return null},r:function(a,b){if(h(a)!==l)throw Error("The alias must be a string.");
if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");var c;c=h(b,!0);if(c===k&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");this.map[a]||(this.map[a]=[]);switch(c){case l:this.map[a].push(b);break;case k:(b.conditionally===E||b.conditionally)&&this.map[a].push(q(b.src));break;case n:for(c=b.length-1;0<=c;c--)this.r(a,b[c])}return this},l:function(a){var b=[],c;switch(h(a,!0)){case l:if(this.map[a])for(c=0;c<this.map[a].length;c++)y(b,this.l(this.map[a][c]));
break;case k:(a.conditionally===E||a.conditionally)&&y(b,this.l(a.src));break;case n:for(c=a.length-1;0<=c;c--)y(b,this.l(a[c]));break;default:throw Error("Alias is not a recognized type.");}return 0===b.length?[a]:b}};F(u.prototype,{src:null,type:p,C:!1,status:0,d:null,b:null,f:null,a:null,H:function(){if(6!==this.status){var a;for(a=this.d.length-1;0<=a;a--)this.d[a].matches(this)&&this.d.splice(a,1);for(a=this.b.length-1;0<=a;a--)this.b[a].matches(this)&&this.b.splice(a,1);delete this.d;delete this.b;
delete this.f;delete this.a;delete this.a;delete this.src;delete this.type;delete this.C;this.status=6}},h:function(){if(4===this.status){var a;if(this.v()){this.status=7;for(a=0;a<this.b.length;a++)this.b[a].h();for(a=0;a<this.f.length;a++)this.f[a]();for(a=0;a<this.d.length;a++)this.d[a].h();if(s.L())for(a=0;a<D.length;a++)D[a]()}}},v:function(){if(4!==this.status&&7!==this.status)return!1;for(var a=this.b.length-1;0<=a;a--)if(!this.b[a].v())return!1;return!0},o:function(a){if(!a||a.constructor!==
u)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===z(this.b,a)&&(a.d.push(this),this.b.push(a)),4===a.status&&this.h())},m:function(a){if("function"!==h(a))throw Error("dependency resolution callback function must be a function.");4===this.Q?a():this.f.push(a)},matches:function(a){var b=h(a);if(b===l)return this.src===a;if(b===k)return this.src===a.src&&this.type==a.type},K:function(a){if(!this.matches(a)){var b=z(this.b,a);0<=b&&this.b.splice(b,1);b=z(a.d,
this);0<=b&&a.d.splice(b,1)}},k:function(){if(3===this.status){var a,b,c,d,e;c=C.splice(0,C.length);for(a=0;a<c.length;a++)if(d=c[a],d.type===x&&6!==d.status){for(b=d.b.length-1;0<=b;b--)e=d.b[b],this.o(e),d.K(e);for(b=d.f.length-1;0<=b;b--)this.m(d.f[b]);s.A(d)}this.status=4;6!==this.status&&this.h()}},load:function(){var a=this;a.status=2;if(a.type===p)a.a=w.createElement("script"),a.a.src=I(a.src,a.type),a.a.type="text/javascript",a.a.defer=!1,a.a.async=!0;else if(a.type===t)a.a=w.createElement("link"),
a.a.type="text/css",a.a.href=I(a.src,a.type),a.a.rel="stylesheet";else throw Error("Attempting to load an unsupported file type: "+this.type);g.g.name===A&&9>g.g.version?a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.k()}:a.a.addEventListener("load",function(){a.status=3;a.k()},!0);w.getElementsByTagName("head")[0].appendChild(this.a)},j:function(){if(0!==this.status)throw Error("Attempting to initiate a previously initiated dependency.");
this.status=1;this.type!==x&&this.type!==B?this.load():this.h()}});var s={c:{},q:0,M:function(){for(var a in this.c)this.c[a].C=!1},empty:function(){return 0===this.q},I:function(){var a,b;for(a in this.c)if(b=this.c[a],b.a&&"interactive"===b.a.readyState)return b;return null},p:function(a){switch(h(a)){case l:return this.c[a]||null;case k:return this.c[a.src]||null;default:return null}},s:function(a){if(!this.p(a)){var b;switch(h(a)){case l:b=new u(a,p);b.j();this.c[a]=b;break;case k:this.c[a.src]=
a}}this.q++;return this},A:function(a){switch(h(a)){case l:return this.A(this.p(a));case k:delete this.c[a.src],a.H()}return this},k:function(){for(var a in this.c)this.c[a].N||this.c[a].k()},L:function(){var a,b;for(a in this.c)if(b=this.c[a].status,7!==b&&5!==b&&6!==b)return!1;return!0}},D=[],Z=0;e.w=function(a){D.push(a)};e.ready=e.w;e.G=function(){H();return e};e.config=e.G;e.n=function(a,b,c){a&&e(b,c);return e};e.conditionally=e.n;e.i=function(a,b){K.r(a,b);return e};e.alias=e.i;e.e=function(a,
b){var c;switch(h(a,!0)){case l:case k:return e(q(a),b);case n:for(c=a.length-1;0<=c;c--)a[c]=q(a[c]);return e(a,b);default:throw Error("Valid dependencies must be entered");}};e.css=e.e;e.e.n=function(a,b,c){a&&e.e(b,c);return e};e.css.conditionally=e.e.n;e.e.i=function(a,b){return e.i(a,q(b))};e.css.alias=e.e.i;g.J||(f.using=e);g.u&&e(g.u);g.t&&e.e(g.t);return e})(window||global,(window||global).using?using.configuration:null);
