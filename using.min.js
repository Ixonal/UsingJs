/*
UsingJs script loader and dependency tracker
Copyright 2013 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(p){function r(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,f,d;for(f=1;f<arguments.length;f++)if(c=arguments[f])for(d in c)b[d]=c[d];return b}function v(a){var b=arguments[0],c,f,d;if(!b||b.constructor!==w)throw Error("The mergee must be an array.");for(f=1;f<arguments.length;f++){c=arguments[f];if(!c||c.constructor!==w)throw Error("The merger must be an array.");if(c)for(d=0;d<c.length;d++)b.push(c[d])}}function y(a,b){for(var c=
0;c<a.length;c++)if(a[c].matches(b))return c;return-1}function l(a,b){return null===a?"null":a===p?"undefined":"object"===typeof a?a.constructor===h.Array?b?"array":0<a.length?"array<"+l(a[0])+">":"array<object>":a.constructor===h.RegExp?"regexp":a.constructor===h.Date?"date":a.src?"dependency":"object":typeof a}function E(a){k=r({},N,k,a);if(!k.browser){a=r;var b=k,c;c={name:"unknown",version:null};var f,d=3,e,l;if(h.navigator)if(f=O.exec(h.navigator.userAgent)){e=s.createElement("div");for(l=e.getElementsByTagName("i");e.innerHTML=
"\x3c!--[if gt IE "+ ++d+"]><i></i><![endif]--\x3e",l[0];);c.name="ie";c.version=4<d?d:+(f[2]||f[4])}else if(f=P.exec(h.navigator.userAgent))c.name="cr",c.version=+f[1];else if(f=Q.exec(h.navigator.userAgent))c.name="ff",c.version=+f[1];else if(f=R.exec(h.navigator.userAgent))c.name="sf",c.version=+f[1];c={browser:c};a(b,c)}k.environment="undefined"!==typeof module&&this.O!==module?"nd":h.document?"wb":"ww";a:{c=s.getElementsByTagName("script");d=["using.js","using.min.js",k.srcName];for(a=0;a<c.length;a++)for(f=
c[a].src,b=0;b<d.length;b++)if((e=d[b])&&f.substr(f.length-e.length,e.length)===e){f=c[a];break a}f=null}if(!f)throw Error("Could not locate the using.js script include. \nPlease specify the name of the source file in the configuration.");a=f.getAttribute("data-script-root");b=f.getAttribute("data-style-root");c=f.getAttribute("data-using");f=f.getAttribute("data-using-css");a&&"/"!==a.substr(a.length-1,1)&&(a+="/");k.scriptRoot=a||"/";b&&"/"!==b.substr(b.length-1,1)&&(b+="/");k.styleRoot=b||"/";
c&&(k.initialUsing=h.eval("("+c+")"));f&&(k.initialStyleUsing=h.eval("("+f+")"))}function F(a){k.debug&&h.console&&h.console.warn(a)}function G(a,b,c,d){a=""+a;var g=(new Date).getTime(),e;(e=a)?(H.lastIndex=0,e=(e=H.exec(e))?h.location?e[1]!==h.location.protocol||e[2]!==h.location.host:!0:!1):e=!1;if(e)return a+(k.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+g);!c&&d&&-1===a.indexOf("min")&&(a+=".min");c||"<||usingContext||>"===b||"<||page||>"===b||a.substr(a.length-b.length)===b||(a+="."+b);"/"===
a.substr(0,1)&&(a=a.substr(1));k.cached||(a=-1===a.indexOf("?")?a+("?_t="+g):a+("&_t="+g));switch(b){case "js":return k.scriptRoot+a;case "css":return k.styleRoot+a;default:return"/"+a}}function I(a){switch(l(a)){case "string":return S.test(a)?"js":T.test(a)?"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?null:a.type||"js"}}function J(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}function x(a){var b;switch(l(a,!0)){case "string":a=J(a);break;case "dependency":a.noExtension||
(a.src=J(a.src));a.type="css";break;case "array":for(b=a.length-1;0<=b;b--)a[b]=x(a[b])}return a}function K(){return"ie"===k.browser.name&&10>=k.browser.version}function U(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function t(a,b,c,d,g,e){this.src=a;this.type=b||"js";this.f=d;this.k=c;this.g=[];this.d=[];this.b=[];this.i={};g&&(this.name=g);this.j=e!==p?e:k.minified}function z(){if(!A){A=!0;for(var a=0;a<
B.length;a++)B[a]()}}function V(){if(!C){C=!0;var a=k.pollingTimeout;setTimeout(function c(){A||(n.v()?z():setTimeout(c,a));C=!1},a)}}function D(a,b,c,f){var g,e,h,q,m,p,r=n.empty();switch(l(a,!0)){case "function":d.A(a);return;case "string":case "dependency":case "array":g=L.m(a);break;default:throw Error("Valid dependencies must be entered");}h=[];f?m=f:r||u?(m=n.M(),m||(m=new t("<||page||>","<||page||>"),n.s(m),m.o()),8===m.status&&(m.status=4)):K()?m=n.L():"currentScript"in s&&(m=n.K());for(e=
g.length-1;0<=e;e--){q=n.q(g[e]);if(!q){switch(l(g[e],!0)){case "string":p=!1;q=new t(g[e],I(g[e]),!1,null);break;case "dependency":p=g[e].dependsOn,q=new t(g[e].src,I(g[e]),g[e].noExtension,g[e].backup,g[e].name,g[e].minified)}n.s(q);p?function(){var a=q;D(g[e].dependsOn,function(){a.load()},null,a);a.o()}():q.o()}h.push(q)}if(m){for(e=h.length-1;0<=e;e--)m.u(h[e]),f&&h[e].p(b);b&&!f&&m.p(b);c&&(m.name=c)}else{a=new t("<||usingContext||>"+W++,"<||usingContext||>",a.noExtension,a.backup,c,a.minified);
n.s(a);for(e=h.length-1;0<=e;e--)a.u(h[e]);b&&a.p(b);c&&(a.name=c);a.o();r||u||K()||M.push(a)}"ie"===k.browser.name&&V()}function d(a,b){D(a,b);return d}var h=this||(0,eval)("this"),k=h.using?d.configuration:null,w=h.Array,N={noConflict:!1,scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},M=[],u=!1,s=h.document,O=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,P=/Chrome\/(\d+)/i,Q=/Firefox\/(\d+)/i,R=/Safari\/(\d+)/i,S=/\.((js)|(jscript))$/i,T=/\.(css)$/i,H=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/;
E(k);var L={map:{},q:function(a){var b,c,d=l(a,!0);for(b in this.map)for(c=this.map[b].length-1;0<=c;c--)switch(d){case "string":switch(l(this.map[b][c],!0)){case "string":if(this.map[b][c]===a)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a)return this.map[b][c]}break;case "dependency":switch(l(this.map[b][c],!0)){case "string":if(this.map[b][c]===a.src)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a.src&&this.map[b][c].type===a.type&&this.map[b][c].conditionally===
a.conditionally&&this.map[b][c].dependsOn===a.dependsOn&&this.map[b][c].noExtension===a.noExtension&&this.map[b][c].backup===a.backup)return this.map[b][c]}}return null},D:function(a,b){if("string"!==l(a))throw Error("The alias must be a string.");var c;c=l(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===c&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");switch(c){case "array":d=[];for(c=b.length-1;0<=c;c--)v(d,
this.m(b[c]));break;case "string":case "dependency":d=this.m(b)}this.map[a]=d;return this},m:function(a){var b=[],c;switch(l(a,!0)){case "string":if(this.map[a])for(c=0;c<this.map[a].length;c++)v(b,this.m(this.map[a][c]));else return[a];break;case "dependency":return a.conditionally===p||!0===a.conditionally?(b=this.m(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===a.length)return b;for(c=a.length-1;0<=c;c--)v(b,this.m(a[c]));0===b.length&&v(b,a);break;default:throw Error("Alias is not a recognized type.");
}return 0===b.length?[a]:b}};r(t.prototype,{src:null,f:null,h:!1,type:"js",k:!1,status:0,d:null,b:null,g:null,a:null,i:null,name:null,j:!1,H:function(){if(6!==this.status){var a;for(a=this.d.length-1;0<=a;a--)this.d[a].matches(this)&&this.d.splice(a,1);for(a=this.b.length-1;0<=a;a--)this.b[a].matches(this)&&this.b.splice(a,1);delete this.d;delete this.b;delete this.g;delete this.a;delete this.a;delete this.src;delete this.f;delete this.h;delete this.type;this.status=6}},I:function(){var a,b;if(4===
this.status){this.status=7;for(a=0;a<this.b.length;a++)8!==this.b[a].status&&this.b[a].l();for(a=0;a<this.g.length;a++)switch(b=this.g[a](this.J(),this.i),l(b,!0)){case "object":r(this.i,b);break;default:b&&(this.i=b)}this.status=8;for(a=0;a<this.d.length;a++)8!=this.d[a].status&&this.d[a].l();"<||page||>"!==this.type&&n.v()&&z()}},J:function(){var a,b,c={};for(a=this.b.length-1;0<=a;a--)if(b=this.b[a],!U(b.i)){var d=b.i;b=(b.name||b.src).split(/[\.\/\\]+/);for(var g=c,e=void 0,e=0;e<b.length-1;e++)g=
g[b[e]]=g[b[e]]||{};g[b[b.length-1]]=d}return c},l:function(){if(4===this.status||9===this.status)9===this.status?n.v()&&z():this.w()&&this.I()},w:function(a){var b;if(8===this.status)return!0;if(4!==this.status)return!1;a=a||[];a.push(this);for(var c=this.b.length-1;0<=c;c--){b=this.b[c];var d;a:if(w.prototype.indexOf)d=w.prototype.indexOf.apply(a,b);else{for(d=0;d<a.length;d++)if(a[d]===b)break a;d=-1}if(-1!==d){if(k.debug){d="Cyclic dependency found (non-terminal): \n";var g;for(g=0;g<a.length;g++)d+=
a[g]===b?"---\x3e":"    ",d+=(a[g].name||a[g].src)+"\n";d+="---\x3e"+(b.name||b.src);F(d)}}else if(!b.w(a))return!1}return!0},u:function(a){if(!a||a.constructor!==t)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===y(this.b,a)&&(a.d.push(this),this.b.push(a)),4===a.status&&this.l())},p:function(a){if("function"!==l(a))throw Error("dependency resolution callback function must be a function.");7===this.status||8===this.status?a():this.g.push(a)},matches:function(a){var b=
l(a);if("string"===b)return this.src===a;if("dependency"===b)return this.src===a.src&&this.type==a.type},N:function(a){if(!this.matches(a)){var b=y(this.b,a);0<=b&&this.b.splice(b,1);b=y(a.d,this);0<=b&&a.d.splice(b,1)}},C:function(){if(3===this.status){for(var a,b,c;(b=M.shift())!==p;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=b.name);b.k&&(this.k=b.k);b.j!==p&&(this.j=b.j);for(a=b.b.length-1;0<=a;a--)c=b.b[a],this.u(c),b.N(c);for(a=b.g.length-1;0<=a;a--)this.p(b.g[a]);n.B(b)}this.status=
4;this.l()}},error:function(a){var b,c;this.status=9;b=this.h?this.f:this.src;"<||page||>"===b&&(b="page");"<||usingContext||>"===b&&(b="using context");c="UsingJs: An error has occurred when loading "+b;a&&(b=a.h?a.f:a.src,"<||page||>"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");k.debug&&h.console&&h.console.error(c);for(a=this.d.length-1;0<=a;a--)b=this.d[a],9!==b.status&&5!==b.status&&8!==b.status&&b.error(this);this.l()},load:function(){var a=
this,b,c;if(1===this.status){for(b=a.b.length-1;0<=b;b--){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("js"===a.type)a.a=s.createElement("script"),a.a.setAttribute("src",G(a.h?a.f:a.src,a.type,a.k,this.j)),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===a.type)a.a=s.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",G(a.h?a.f:a.src,a.type,a.k,this.j)),
a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+a.type);b=function(){a.f&&!a.h?(F("Error occurred while loading "+a.src+", attempting to load "+a.f),a.h=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.C()},!0),a.a.addEventListener("error",b,!0)):"ie"===k.browser.name&&9>k.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=
null,a.status=3,a.C()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");s.getElementsByTagName("head")[0].appendChild(a.a)}},o:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==this.type?(this.status=1,this.load()):(this.status=4,this.l()))}});var n={c:{},r:0,empty:function(){return 0===this.r},M:function(){return this.c["<||page||>"]},L:function(){var a,b;for(a in this.c)if(b=this.c[a],b.a&&
"interactive"===b.a.readyState)return b;return null},K:function(){var a,b,c=s.currentScript;if(!c.src)return null;for(a in this.c)if(b=this.c[a],b.a&&b.a===c)return b;return null},q:function(a){switch(l(a)){case "string":return this.c[a]||null;case "dependency":return this.c[a.src]?this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},s:function(a){if(!this.q(a)){var b;switch(l(a)){case "string":b=new t(a,"js");b.o();this.c[a]=b;break;case "dependency":this.c[a.src]=a}}this.r++;
return this},B:function(a){switch(l(a)){case "string":return this.B(this.q(a));case "dependency":delete this.c[a.src],a.H()}this.r--;return this},v:function(){var a,b;for(a in this.c)if(b=this.c[a].status,8!==b&&5!==b&&6!==b&&9!==b)return!1;return!0}},B=[],A=!1,C=!1,W=0;d.F=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);"string"===l(a,!0)&&a!==b&&d.n(a,b);D(b,c,a);return d};d.amd=d.F;d.page=function(a,b){u=!0;switch(l(a,!0)){case "function":a();break;default:d(a,b)}u=!1;return d};d.page=d.page;
d.page.e=function(a,b){u=!0;switch(l(a,!0)){case "function":a();break;default:d.e(a,b)}u=!1;return d};d.page.css=d.page.e;d.A=function(a){B.push(a);return d};d.ready=d.A;d.G=function(a){E(a);return d};d.config=d.G;d.t=function(a,b,c){a&&d(b,c);return d};d.conditionally=d.t;d.n=function(a,b){L.D(a,b);return d};d.alias=d.n;d.e=function(a,b){var c;switch(l(a,!0)){case "string":case "dependency":return d(x(a),b);case "array":for(c=a.length-1;0<=c;c--)a[c]=x(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");
}};d.css=d.e;d.e.t=function(a,b,c){a&&d.e(b,c);return d};d.e.conditionally=d.e.t;d.e.n=function(a,b){return d.n(a,x(b))};d.e.alias=d.e.n;k.noConflict||(h.using=d);k.initialUsing&&d.page(k.initialUsing);k.initialStyleUsing&&d.page.e(k.initialStyleUsing);return d})();
