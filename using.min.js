/*
UsingJs script loader and dependency tracker
Copyright 2013 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(D){function x(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,e,d;for(e=1;e<arguments.length;e++)if(c=arguments[e])for(d in c)b[d]=c[d];return b}function y(a){var b=arguments[0],c,e,d;if(!b||b.constructor!==z)throw Error("The mergee must be an array.");for(e=1;e<arguments.length;e++){c=arguments[e];if(!c||c.constructor!==z)throw Error("The merger must be an array.");if(c)for(d=0;d<c.length;d++)b.push(c[d])}}function E(a,b){for(var c=
0;c<a.length;c++)if(a[c].matches(b))return c;return-1}function l(a,b){return null===a?"null":a===D?"undefined":typeof a===F?a.constructor===f.Array?b?t:0<a.length?t+"<"+l(a[0])+">":t+"<object>":a.constructor===f.RegExp?V:a.constructor===f.Date?W:a.src?m:F:typeof a}function N(a){h=x({},X,h,a);if(!h.browser){a=x;var b=h,c;c={name:Y,version:null};var e,d=3,g,l;if(f.navigator)if(e=Z.exec(f.navigator.userAgent)){g=u.createElement("div");for(l=g.getElementsByTagName("i");g.innerHTML="\x3c!--[if gt IE "+
++d+"]><i></i><![endif]--\x3e",l[0];);c.name=A;c.version=4<d?d:+e[1]}else if(e=$.exec(f.navigator.userAgent))c.name=aa,c.version=+e[1];else if(e=ba.exec(f.navigator.userAgent))c.name=ca,c.version=+e[1];else if(e=da.exec(f.navigator.userAgent))c.name=ea,c.version=+e[1];c={browser:c};a(b,c)}h.environment="undefined"!==typeof f.module&&this.M!==f.module?fa:f.document?ga:ha;a:{c=u.getElementsByTagName("script");d=["using.js","using.min.js",h.srcName];for(a=0;a<c.length;a++)for(e=c[a].src,b=0;b<d.length;b++)if(e.substr(e.length-
d[b].length,d[b].length)===d[b]){e=c[a];break a}e=null}if(null===e)throw Error("Could not locate the using.js script include. \nPlease specify the name of the source file in the configuration.");a=e.getAttribute("data-script-root");b=e.getAttribute("data-style-root");c=e.getAttribute("data-using");e=e.getAttribute("data-using-css");a&&"/"!==a.substr(a.length-1,1)&&(a+="/");h.scriptRoot=a||"/";b&&"/"!==b.substr(b.length-1,1)&&(b+="/");h.styleRoot=b||"/";c&&(h.initialUsing=f.eval("("+c+")"));e&&(h.initialStyleUsing=
f.eval("("+e+")"))}function G(a){f.console&&f.console.error(a)}function O(a,b,c){a=""+a;var d=(new Date).getTime(),k;(k=a)?(P.lastIndex=0,k=(k=P.exec(k))?f.location?k&&(k[1]!==f.location.protocol||k[2]!==f.location.host):!0:!1):k=!1;if(k)return a+(h.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+d);c||a.substr(a.length-b.length)===b||(a+="."+b);"/"===a.substr(0,1)&&(a=a.substr(1));h.cached||(a=-1===a.indexOf("?")?a+("?_t="+d):a+("&_t="+d));switch(b){case p:return h.scriptRoot+a;case r:return h.styleRoot+
a;default:return"/"+a}}function Q(a){switch(l(a)){case n:return ia.test(a)?p:ja.test(a)?r:p;case m:return a.type||p}}function R(a,b){a.substr(a.length-(b.length+1),b.length+1)!=="."+b&&(a+="."+b);return a}function B(a){var b;switch(l(a,!0)){case n:a=R(a,r);break;case m:a.noExtension||(a.src=R(a.src,r));a.type=r;break;case t:for(b=a.length-1;0<=b;b--)a[b]=B(a[b])}return a}function S(){return h.browser.name===A&&10>=h.browser.version}function ka(a){if(Object.keys)return 0===Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;
return!0}function v(a,b,c,d,k){this.src=a;this.type=b||p;this.g=d;this.s=c;this.f=[];this.c=[];this.b=[];this.h={};k&&(this.name=k)}function H(){if(!I){I=!0;for(var a=0;a<J.length;a++)J[a]()}}function la(){if(!K){K=!0;var a=h.pollingTimeout;setTimeout(function c(){I||(q.t()?H():setTimeout(c,a));K=!1},a)}}function L(a,b,c,e){var k,g,f,s,p,r=q.empty();switch(l(a,!0)){case "function":d.w(a);return;case n:case m:case t:k=T.j(a);break;default:throw Error("Valid dependencies must be entered");}a=[];e?s=
e:r||w?(s=new v(M,M),s.k()):S()?s=q.K():"currentScript"in u&&(s=q.J());for(g=k.length-1;0<=g;g--){f=q.o(k[g]);if(!f){switch(l(k[g],!0)){case n:p=!1;f=new v(k[g],Q(k[g]),!1,null);break;case m:p=k[g].dependsOn,f=new v(k[g].src,Q(k[g]),k[g].noExtension,k[g].backup)}q.u(f);p?function(){var a=f;L(k[g].dependsOn,function(){a.load()},null,a);a.k()}():f.k()}a.push(f)}if(s){for(g=a.length-1;0<=g;g--)s.r(a[g]),e&&a[g].m(b);b&&!e&&s.m(b);c&&(s.name=c)}else{e=new v(C+ma++,C);q.u(e);for(g=a.length-1;0<=g;g--)e.r(a[g]);
b&&e.m(b);c&&(e.name=c);e.k();r||w||S()||U.push(e)}h.browser.name===A&&la()}function d(a,b){L(a,b);return d}var f=this||(0,eval)("this"),h=f.using?d.configuration:null,z=f.Array,X={noConflict:!1,scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200},U=[],w=!1,u=f.document,F="object",n="string",t="array",m="dependency",W="date",V="regexp",p="js",r="css",C="usingContext",M="page",ga="wb",ha="ww",fa="nd",Z=/MSIE\s*(\d+)/i,$=/Chrome\/(\d+)/i,ba=/Firefox\/(\d+)/i,da=/Safari\/(\d+)/i,ia=/\.((js)|(jscript))$/i,
ja=/\.(css)$/i,P=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,Y="unknown",A="ie",ca="ff",aa="cr",ea="sf";N(h);var T={map:{},o:function(a){var b,c,d=l(a,!0);for(b in this.map)for(c=this.map[b].length-1;0<=c;c--)switch(d){case n:switch(l(this.map[b][c],!0)){case n:if(this.map[b][c]===a)return this.map[b][c];break;case m:if(this.map[b][c].src===a)return this.map[b][c]}break;case m:switch(l(this.map[b][c],!0)){case n:if(this.map[b][c]===a.src)return this.map[b][c];break;case m:if(this.map[b][c].src===a.src&&this.map[b][c].type===
a.type&&this.map[b][c].conditionally===a.conditionally&&this.map[b][c].dependsOn===a.dependsOn&&this.map[b][c].noExtension===a.noExtension&&this.map[b][c].backup===a.backup)return this.map[b][c]}}return null},C:function(a,b){if(l(a)!==n)throw Error("The alias must be a string.");var c;c=l(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if(c===m&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");switch(c){case t:d=[];for(c=b.length-
1;0<=c;c--)y(d,this.j(b[c]));break;case n:case m:d=this.j(b)}this.map[a]=d;return this},j:function(a){var b=[],c;switch(l(a,!0)){case n:if(this.map[a])for(c=0;c<this.map[a].length;c++)y(b,this.j(this.map[a][c]));else return[a];break;case m:return a.conditionally===D||!0===a.conditionally?(b=this.j(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case t:if(0===a.length)return b;for(c=a.length-1;0<=c;c--)y(b,this.j(a[c]));0===b.length&&y(b,a);break;default:throw Error("Alias is not a recognized type.");
}return 0===b.length?[a]:b}};x(v.prototype,{src:null,g:null,l:!1,type:p,s:!1,status:0,c:null,b:null,f:null,a:null,h:null,name:null,G:function(){if(6!==this.status){var a;for(a=this.c.length-1;0<=a;a--)this.c[a].matches(this)&&this.c.splice(a,1);for(a=this.b.length-1;0<=a;a--)this.b[a].matches(this)&&this.b.splice(a,1);delete this.c;delete this.b;delete this.f;delete this.a;delete this.a;delete this.src;delete this.g;delete this.l;delete this.type;this.status=6}},H:function(){var a,b;if(4===this.status){this.status=
7;for(a=0;a<this.b.length;a++)8!==this.b[a].status&&this.b[a].i();for(a=0;a<this.f.length;a++)switch(b=this.f[a](this.I(),this.h),l(b,!0)){case F:x(this.h,b);break;default:b&&(this.h=b)}this.status=8;for(a=0;a<this.c.length;a++)8!=this.c[a].status&&this.c[a].i();q.t()&&H()}},I:function(){var a,b,c={};for(a=this.b.length-1;0<=a;a--)if(b=this.b[a],!ka(b.h)){var d=b.h;b=(b.name||b.src).split(/[\.\/\\]+/);for(var f=c,g=void 0,g=0;g<b.length-1;g++)f=f[b[g]]=f[b[g]]||{};f[b[b.length-1]]=d}return c},i:function(){if(4===
this.status||9===this.status)9===this.status?q.t()&&H():this.v()&&this.H()},v:function(a){var b;if(8===this.status)return!0;if(4!==this.status)return!1;a=a||[];a.push(this);for(var c=this.b.length-1;0<=c;c--){b=this.b[c];var d;a:if(z.prototype.indexOf)d=z.prototype.indexOf.apply(a,b);else{for(d=0;d<a.length;d++)if(a[d]===b)break a;d=-1}if(-1!==d)G("Cyclic dependency found (non-terminal): "+(b.name||b.src));else if(!b.v(a))return!1}return!0},r:function(a){if(!a||a.constructor!==v)throw Error("The other dependency must be a valid Dependency object.");
this.matches(a)||(-1===E(this.b,a)&&(a.c.push(this),this.b.push(a)),4===a.status&&this.i())},m:function(a){if("function"!==l(a))throw Error("dependency resolution callback function must be a function.");4===this.status?a():this.f.push(a)},matches:function(a){var b=l(a);if(b===n)return this.src===a;if(b===m)return this.src===a.src&&this.type==a.type},L:function(a){if(!this.matches(a)){var b=E(this.b,a);0<=b&&this.b.splice(b,1);b=E(a.c,this);0<=b&&a.c.splice(b,1)}},B:function(){if(3===this.status){for(var a,
b,c;(b=U.shift())!==D;)if(b.type===C&&6!==b.status){for(a=b.b.length-1;0<=a;a--)c=b.b[a],this.r(c),b.L(c);for(a=b.f.length-1;0<=a;a--)this.m(b.f[a]);q.A(b)}this.status=4;this.i()}},error:function(a){var b;this.status=9;b="UsingJs: An error has occurred when loading "+this.src;a&&(b+=" - dependency "+a.src+" registered an error");G(b);for(a=this.c.length-1;0<=a;a--)b=this.c[a],9!==b.status&&5!==b.status&&8!==b.status&&b.error(this);this.i()},load:function(){var a=this,b,c;if(1===this.status){for(b=
a.b.length-1;0<=b;b--){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if(a.type===p)a.a=u.createElement("script"),a.a.setAttribute("src",O(a.l?a.g:a.src,a.type,a.s)),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if(a.type===r)a.a=u.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",O(a.l?a.g:a.src,a.type,a.s)),a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+
a.type);b=function(){a.g&&!a.l?(G("Error occurred while loading "+a.src+", attempting to load "+a.g),a.l=!0,a.status=1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.B()},!0),a.a.addEventListener("error",b,!0)):h.browser.name===A&&9>h.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.B()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");
u.getElementsByTagName("head")[0].appendChild(a.a)}},k:function(){0===this.status&&(this.type!==C&&this.type!==M?(this.status=1,this.load()):(this.status=4,this.i()))}});var q={e:{},p:0,empty:function(){return 0===this.p},K:function(){var a,b;for(a in this.e)if(b=this.e[a],b.a&&"interactive"===b.a.readyState)return b;return null},J:function(){var a,b,c=u.currentScript;if(!c.src)return null;for(a in this.e)if(b=this.e[a],b.a&&b.a===c)return b;return null},o:function(a){switch(l(a)){case n:return this.e[a]||
null;case m:return this.e[a.src]||null;default:return null}},u:function(a){if(!this.o(a)){var b;switch(l(a)){case n:b=new v(a,p);b.k();this.e[a]=b;break;case m:this.e[a.src]=a}}this.p++;return this},A:function(a){switch(l(a)){case n:return this.A(this.o(a));case m:delete this.e[a.src],a.G()}this.p--;return this},t:function(){var a,b;for(a in this.e)if(b=this.e[a].status,8!==b&&5!==b&&6!==b&&9!==b)return!1;return!0}},J=[],I=!1,K=!1,ma=0;d.D=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);L(b,
c,a);return d};d.amd=d.D;d.page=function(a,b){w=!0;switch(l(a,!0)){case "function":a();break;default:d(a,b)}w=!1;return d};d.page=d.page;d.page.d=function(a,b){w=!0;switch(l(a,!0)){case "function":a();break;default:d.d(a,b)}w=!1;return d};d.page.css=d.page.d;d.w=function(a){J.push(a);return d};d.ready=d.w;d.F=function(a){N(a);return d};d.config=d.F;d.q=function(a,b,c){a&&d(b,c);return d};d.conditionally=d.q;d.n=function(a,b){T.C(a,b);return d};d.alias=d.n;d.d=function(a,b){var c;switch(l(a,!0)){case n:case m:return d(B(a),
b);case t:for(c=a.length-1;0<=c;c--)a[c]=B(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");}};d.css=d.d;d.d.q=function(a,b,c){a&&d.d(b,c);return d};d.d.conditionally=d.d.q;d.d.n=function(a,b){return d.n(a,B(b))};d.d.alias=d.d.n;h.noConflict||(f.using=d);h.initialUsing&&d.page(h.initialUsing);h.initialStyleUsing&&d.page.d(h.initialStyleUsing);return d})();
