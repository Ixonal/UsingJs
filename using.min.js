/*

UsingJs script loader and dependency tracker
Copyright 2013-2016 Benjamin McGregor (Ixonal)
Released under the MIT Licence
http://opensource.org/licenses/MIT
*/
(function(p){function r(a){if(1>=arguments.length)throw Error("At least an extender and extendee are required");var b=arguments[0],c,f,l,d;f=1;for(d=arguments.length;f<d;f++)if(c=arguments[f])for(l in c)b[l]=c[l];return b}function w(a){var b=arguments[0],c,f,l,d,e;if(!b||b.constructor!==x)throw Error("The mergee must be an array.");f=1;for(d=arguments.length;f<d;f++){c=arguments[f];if(!c||c.constructor!==x)throw Error("The merger must be an array.");l=0;for(e=c.length;l<e;l++)b.push(c[l])}}function A(a,
b){for(var c=0,f=a.length;c<f;c++)if(a[c].matches(b))return c;return-1}function k(a,b){return null===a?"null":a===p?"undefined":"object"===typeof a?"[object Array]"===Object.prototype.toString.call(a)?b?"array":0<a.length?"array<"+k(a[0])+">":"array<object>":a.constructor===g.RegExp?"regexp":a.constructor===g.Date?"date":a.src?"dependency":"object":typeof a}function G(a){e=r({},P,e,a);if(!e.browser){var b=e,c;c={name:"unknown",version:null};var f,d=3,h,k;if(g.navigator)if(f=Q.exec(g.navigator.userAgent)){h=
t.createElement("div");for(k=h.getElementsByTagName("i");h.innerHTML="\x3c!--[if gt IE "+ ++d+"]><i></i><![endif]--\x3e",k[0];);c.name="ie";c.version=4<d?d:+(f[2]||f[4])}else if(f=R.exec(g.navigator.userAgent))c.name="cr",c.version=+f[1];else if(f=S.exec(g.navigator.userAgent))c.name="ff",c.version=+f[1];else if(f=T.exec(g.navigator.userAgent))c.name="sf",c.version=+f[1];c={browser:c};r(b,c)}e.environment="undefined"!==typeof module&&this.X!==module?"nd":g.document?"wb":"ww";a:{h=t.getElementsByTagName("script");
var n=["using.js","using.min.js",e.srcName],m,b=0;for(f=h.length;b<f;b++)for(k=h[b].src,c=0,d=n.length;c<d;c++)if((m=n[c])&&k.substr(k.length-m.length,m.length)===m){c=h[b];break a}c=null}if(!c)throw Error("Could not locate the using.js script include. \nPlease specify the name of the source file in the configuration.");b=c.getAttribute("data-script-root")||a&&a.scriptRoot||e.scriptRoot;a=c.getAttribute("data-style-root")||a&&a.styleRoot||e.styleRoot;f=c.getAttribute("data-using");c=c.getAttribute("data-using-css");
b&&"/"!==b.substr(b.length-1,1)&&(b+="/");e.scriptRoot=b||"/";a&&"/"!==a.substr(a.length-1,1)&&(a+="/");e.styleRoot=a||"/";f&&(e.initialUsing=g.eval("("+f+")"));c&&(e.initialStyleUsing=g.eval("("+c+")"))}function H(a){e.debug&&g.console&&g.console.warn(a)}function y(a){switch(k(a)){case "string":return U.test(a)?"js":V.test(a)?"css":"js";case "dependency":return"<||page||>"===a.type||"<||usingContext||>"===a.type?"js":a.type||y(a.src)}}function I(a){".css"!==a.substr(a.length-4,4)&&(a+=".css");return a}
function z(a){var b;switch(k(a,!0)){case "string":a=I(a);break;case "dependency":a.noExtension||(a.src=I(a.src));a.type="css";break;case "array":for(b=a.length;b--;)a[b]=z(a[b])}return a}function J(){return"ie"===e.browser.name&&10>=e.browser.version}function W(a){if("object"!=typeof a)return!1;if(Object.keys)return 0===Object.keys(a).length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function K(a,b,c){b=b.split(/[\.\/\\]+/);var f,d;f=0;for(d=b.length-1;f<d;f++)a=a[b[f]]=a[b[f]]||{};a[b[b.length-
1]]=c}function u(a,b,c,f,d,h,k){this.src=a;this.type=b||y(a);this.h=f;this.l=c;this.i=[];this.f=[];this.b=[];this.j={};this.H=k;d&&(this.name=d);this.v=h!==p?h:e.minified}function B(){if(!C){C=!0;for(var a=D.length;a--;)D[a]()}}function X(){if(!E){E=!0;var a=e.pollingTimeout;setTimeout(function c(){C||(n.I()?B():setTimeout(c,a));E=!1},a)}}function F(a,b,c,f){var l,h,g,q,m,p,r=n.empty();switch(k(a,!0)){case "function":d.ready(a);return;case "string":case "dependency":case "array":l=L.o(a);break;default:throw Error("Valid dependencies must be entered");
}g=[];f?m=f:r||v?(m=n.V(),m||(m=new u("<||page||>","<||page||>"),n.D(m),m.u()),8===m.status&&(m.status=4)):J()?m=n.U():"currentScript"in t&&(m=n.T());for(h=l.length;h--;){q=n.B(l[h]);if(!q){switch(k(l[h],!0)){case "string":p=!1;q=new u(l[h],y(l[h]),!1,null);break;case "dependency":p=l[h].dependsOn,q=new u(l[h].src,y(l[h]),l[h].noExtension,l[h].backup,l[h].name,l[h].minified,l[h].exports)}n.D(q);p?function(){var a=q;F(l[h].dependsOn,function(){a.load()},null,a);a.u()}():q.u()}g.push(q)}if(m){for(h=
g.length;h--;)m.G(g[h]),f&&g[h].w(b);b&&!f&&m.w(b);c&&(m.name=c)}else{a=new u("<||usingContext||>"+Y++,"<||usingContext||>",a.noExtension,a.backup,c,a.minified);n.D(a);for(h=g.length;h--;)a.G(g[h]);b&&a.w(b);c&&(a.name=c);a.u();r||v||J()||M.push(a)}"ie"===e.browser.name&&X()}function d(a,b){F(a,b);return d}var g=this||(0,eval)("this"),e=g.using?d.configuration:null,x=g.Array,P={noConflict:!1,scriptRoot:"/",styleRoot:"/",cached:!0,pollingTimeout:200,minified:!1,debug:!1},M=[],v=!1,t=g.document,Q=/(MSIE\s*(\d+))|(rv:(\d+\.?\d*))/i,
R=/Chrome\/(\d+)/i,S=/Firefox\/(\d+)/i,T=/Safari\/(\d+)/i,U=/\.((js)|(jscript))$/i,V=/\.(css)$/i,N=/([a-zA-Z0-9\.]*:)?\/\/([^\/]+)\/?/,O={8:!0,5:!0,6:!0,9:!0};G(e);var L={map:{},B:function(a){var b,c,f=k(a,!0);for(b in this.map)for(c=this.map[b].length;c--;)switch(f){case "string":switch(k(this.map[b][c],!0)){case "string":if(this.map[b][c]===a)return this.map[b][c];break;case "dependency":if(this.map[b][c].src===a)return this.map[b][c]}break;case "dependency":switch(k(this.map[b][c],!0)){case "string":if(this.map[b][c]===
a.src)return this.map[b][c];break;case "dependency":var d=this.map[b][c];if(d.src===a.src&&d.type===a.type&&d.conditionally===a.conditionally&&d.dependsOn===a.dependsOn&&d.noExtension===a.noExtension&&d.backup===a.backup)return this.map[b][c]}}return null},M:function(a,b){if("string"!==k(a))throw Error("The alias must be a string.");var c;c=k(b,!0);var d;if(a===b)throw Error("Mapping to an equivalently named alias is not allowed.");if("dependency"===c&&a===b.src)throw Error("Mapping to an equivalently named alias is not allowed.");
switch(c){case "array":d=[];for(c=b.length;c--;)w(d,this.o(b[c]));break;case "string":case "dependency":d=this.o(b);break;default:throw Error("Unknown dependency type found");}this.map[a]=d;return this},o:function(a){var b=[],c,d;switch(k(a,!0)){case "string":if(this.map[a])for(c=0,d=this.map[a].length;c<d;c++)w(b,this.o(this.map[a][c]));else return[a];break;case "dependency":return a.conditionally===p||!0===a.conditionally?(b=this.o(a.src),0<b.length&&(1!==b.length||b[0]!==a.src)?b:[a]):b;case "array":if(0===
a.length)return b;for(c=a.length;c--;)w(b,this.o(a[c]));0===b.length&&w(b,a);break;default:throw Error("Alias is not a recognized type.");}return 0===b.length?[a]:b}};r(u.prototype,{src:null,h:null,s:!1,type:"js",l:!1,status:0,f:null,b:null,i:null,a:null,j:null,name:null,v:!1,H:null,P:function(){if(6!==this.status){var a;for(a=this.f.length;a--;)this.f[a].matches(this)&&this.f.splice(a,1);for(a=this.b.length;a--;)this.b[a].matches(this)&&this.b.splice(a,1);delete this.f;delete this.b;delete this.i;
delete this.a;delete this.a;delete this.src;delete this.h;delete this.s;delete this.type;this.status=6}},R:function(){var a,b;if(4===this.status){this.status=7;for(a=this.b.length;a--;)8!==this.b[a].status&&this.b[a].m();for(a=this.i.length;a--;)switch(b=this.i[a](this.S(),this.j),k(b,!0)){case "object":r(this.j,b);break;default:b&&(this.j=b)}this.status=8;for(a=this.f.length;a--;)8!=this.f[a].status&&this.f[a].m();"<||page||>"!==this.type&&n.I()&&B()}},S:function(){var a,b,c={};for(a=this.b.length;a--;)if(b=
this.b[a],W(b.j)){if(b.H){var d;a:{d=b.H.split(/[\.\/\\]+/);for(var e=g,h=void 0,k=void 0,h=0,k=d.length;h<k;h++)if(e=e[d[h]],e===p){d=null;break a}d=e}K(c,b.name||b.src,d)}}else K(c,b.name||b.src,b.j);return c},m:function(){if(4===this.status||9===this.status)9===this.status?n.I()&&B():this.J()&&this.R()},J:function(a){var b;if(8===this.status)return!0;if(4!==this.status)return!1;a=a||[];a.push(this);for(var c=this.b.length-1;0<=c;c--){b=this.b[c];var d;a:if(x.prototype.indexOf)d=x.prototype.indexOf.apply(a,
b);else{d=0;for(var g=a.length;d<g;d++)if(a[d]===b)break a;d=-1}if(-1!==d){if(e.debug){d="Cyclic dependency found (non-terminal): \n";for(g=0;g<a.length;g++)d+=a[g]===b?"---\x3e":"    ",d+=(a[g].name||a[g].src)+"\n";d+="---\x3e"+(b.name||b.src);H(d)}}else if(!b.J(a))return!1}return!0},G:function(a){if(!a||a.constructor!==u)throw Error("The other dependency must be a valid Dependency object.");this.matches(a)||(-1===A(this.b,a)&&(a.f.push(this),this.b.push(a)),4===a.status&&this.m())},w:function(a){if("function"!==
k(a))throw Error("dependency resolution callback function must be a function.");7===this.status||8===this.status?a():this.i.push(a)},matches:function(a){var b=k(a);return"string"===b?this.src===a:"dependency"===b?this.src===a.src&&this.type==a.type:!1},W:function(a){if(!this.matches(a)){var b=A(this.b,a);0<=b&&this.b.splice(b,1);b=A(a.f,this);0<=b&&a.f.splice(b,1)}},resolve:function(){if(3===this.status){for(var a,b,c;(b=M.shift())!==p;)if("<||usingContext||>"===b.type&&6!==b.status){b.name&&(this.name=
b.name);b.l&&(this.l=b.l);b.v!==p&&(this.v=b.v);for(a=b.b.length;a--;)c=b.b[a],this.G(c),b.W(c);for(a=b.i.length;a--;)this.w(b.i[a]);n.K(b)}this.status=4;this.m()}},error:function(a){var b,c;this.status=9;b=this.s?this.h:this.src;"<||page||>"===b&&(b="page");"<||usingContext||>"===b&&(b="using context");c="UsingJs: An error has occurred when loading "+b;a&&(b=a.s?a.h:a.src,"<||page||>"===b&&(b="page"),"<||usingContext||>"===b&&(b="using context"),c+=" - dependency "+b+" registered an error");e.debug&&
g.console&&g.console.error(c);for(a=this.f.length;a--;)b=this.f[a],b.status in O||b.error(this);this.m()},L:function(){var a=""+(this.s?this.h:this.src),b=(new Date).getTime(),c;(c=a)?(N.lastIndex=0,c=(c=N.exec(c))?g.location?c[1]!==g.location.protocol||c[2]!==g.location.host:!0:!1):c=!1;if(c)return a+(e.cached?"":(-1===a.indexOf("?")?"?_t=":"&_t=")+b);!this.l&&this.v&&-1===a.indexOf("min")&&(a+=".min");this.l||"<||usingContext||>"===this.type||"<||page||>"===this.type||a.substr(a.length-this.type.length)===
this.type||(a+="."+this.type);"/"===a.substr(0,1)&&(a=a.substr(1));e.cached&&e.version&&(a+=(0<=a.indexOf("?")?"&":"?")+"_v="+encodeURIComponent(e.version));e.cached||(a+=(0<=a.indexOf("?")?"&":"?")+"_t="+b);switch(this.type){case "js":return e.scriptRoot+a;case "css":return e.styleRoot+a;default:return"/"+a}},load:function(){var a=this,b,c;if(1===a.status){for(b=a.b.length;b--;){c=a.b[b];if(2===c.status||1===c.status)return;9===c.status&&c.error()}a.status=2;if("wb"==e.environment){if("js"===a.type)a.a=
t.createElement("script"),a.a.setAttribute("src",a.L()),a.a.setAttribute("type","text/javascript"),a.a.setAttribute("defer","false"),a.a.setAttribute("async","true");else if("css"===a.type)a.a=t.createElement("link"),a.a.setAttribute("type","text/css"),a.a.setAttribute("href",a.L()),a.a.setAttribute("rel","stylesheet");else throw Error("Attempting to load an unsupported file type: "+a.type);b=function(){a.h&&!a.s?(H("Error occurred while loading "+a.src+", attempting to load "+a.h),a.s=!0,a.status=
1,a.load()):a.error()};a.a.addEventListener?(a.a.addEventListener("load",function(){a.status=3;a.resolve()},!0),a.a.addEventListener("error",b,!0)):"ie"===e.browser.name&&9>e.browser.version?(a.a.onreadystatechange=function(){if("complete"===a.a.readyState||"loaded"===a.a.readyState)a.a.onreadystatechange=null,a.status=3,a.resolve()},a.a.attachEvent&&a.a.attachEvent("onerror",b)):a.error("Unable to properly attach events with the current browser configuration.");t.getElementsByTagName("head")[0].appendChild(a.a)}else throw Error("This functionality is not yet implemented");
}},u:function(){0===this.status&&("<||usingContext||>"!==this.type&&"<||page||>"!==this.type?(this.status=1,this.load()):(this.status=4,this.m()))}});var n={c:{},C:0,empty:function(){return 0===this.C},V:function(){return this.c["<||page||>"]},U:function(){var a,b;for(a in this.c)if(b=this.c[a],b.a&&"interactive"===b.a.readyState)return b;return null},T:function(){var a,b,c=t.currentScript;if(!c.src)return null;for(a in this.c)if(b=this.c[a],b.a&&b.a===c)return b;return null},B:function(a){switch(k(a)){case "string":return this.c[a]||
null;case "dependency":return this.c[a.src]?this.c[a.src].type===(a.type||"js")?this.c[a.src]:null:null;default:return null}},D:function(a){if(!this.B(a)){var b;switch(k(a)){case "string":b=new u(a,"js");b.u();this.c[a]=b;break;case "dependency":this.c[a.src]=a}}this.C++;return this},K:function(a){switch(k(a)){case "string":return this.K(this.B(a));case "dependency":delete this.c[a.src],a.P()}this.C--;return this},I:function(){var a,b;for(a=this.c.length;a--;)if(b=this.c[a].status,b in O)return!1;
return!0}},D=[],C=!1,E=!1,Y=0;d.N=function(a,b,c){2===arguments.length&&(c=b,b=a,a=null);F(b,c,a);return d};d.amd=d.N;d.page=function(a,b){v=!0;switch(k(a,!0)){case "function":a.call(g);break;default:d(a,b)}v=!1;return d};d.page=d.page;d.page.g=function(a,b){v=!0;switch(k(a,!0)){case "function":a.call(g);break;default:d.g(a,b)}v=!1;return d};d.page.css=d.page.g;d.ready=function(a){D.push(a);return d};d.ready=d.ready;d.O=function(a){G(a);return d};d.config=d.O;d.F=function(a,b,c){a&&d(b,c);return d};
d.conditionally=d.F;d.A=function(a,b){L.M(a,b);return d};d.alias=d.A;d.g=function(a,b){var c;switch(k(a,!0)){case "string":case "dependency":return d(z(a),b);case "array":for(c=a.length;c--;)a[c]=z(a[c]);return d(a,b);default:throw Error("Valid dependencies must be entered");}};d.css=d.g;d.g.F=function(a,b,c){a&&d.g(b,c);return d};d.g.conditionally=d.g.F;d.g.A=function(a,b){return d.A(a,z(b))};d.g.alias=d.g.A;e.noConflict||(g.using=d);e.initialUsing&&d.page(e.initialUsing);e.initialStyleUsing&&d.page.g(e.initialStyleUsing);
return d})();
